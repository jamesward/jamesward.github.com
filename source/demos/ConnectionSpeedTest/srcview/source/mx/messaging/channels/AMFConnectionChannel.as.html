<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>AMFConnectionChannel.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">////////////////////////////////////////////////////////////////////////////////
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//  ADOBE SYSTEMS INCORPORATED
</span><span class="ActionScriptComment">//  Copyright 2005-2007 Adobe Systems Incorporated
</span><span class="ActionScriptComment">//  All Rights Reserved.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//  NOTICE: Adobe permits you to use, modify, and distribute this file
</span><span class="ActionScriptComment">//  in accordance with the terms of the license agreement accompanying it.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">////////////////////////////////////////////////////////////////////////////////
</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">channels</span>
<span class="ActionScriptBracket/Brace">{</span>

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">AsyncErrorEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">ErrorEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">IOErrorEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">NetStatusEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">SecurityErrorEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">TimerEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">net</span>.<span class="ActionScriptDefault_Text">ObjectEncoding</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flex</span>.<span class="ActionScriptDefault_Text">net</span>.<span class="ActionScriptDefault_Text">AMFConnection</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flex</span>.<span class="ActionScriptDefault_Text">net</span>.<span class="ActionScriptDefault_Text">IAMFResponder</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">mx_internal</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">logging</span>.<span class="ActionScriptDefault_Text">Log</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">MessageAgent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">MessageResponder</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">ChannelEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">ChannelFaultEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">MessageEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">AcknowledgeMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">AsyncMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">CommandMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">ErrorMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">IMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">ISmallMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">MessagePerformanceInfo</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">MessagePerformanceUtils</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">StringUtil</span>;

<span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">mx_internal</span>;

<span class="ActionScriptASDoc">/**
 *  This AMFConnectionChannel provides the basic AMFConnection support for messaging.
 *  The AMFChannel and RTMPChannel both extend this class.
 */</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">AMFConnectionChannel</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">PollingChannel</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Constructor
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  Creates a new AMFConnectionChannel instance.
     *  &lt;p&gt;
     *  The underlying AMFConnection&apos;s &lt;code&gt;objectEncoding&lt;/code&gt;
     *  is set to &lt;code&gt;ObjectEncoding.AMF3&lt;/code&gt; by default. It can be
     *  changed manually by accessing the channel&apos;s &lt;code&gt;netConnection&lt;/code&gt;
     *  property. The global &lt;code&gt;AMFConnection.defaultObjectEncoding&lt;/code&gt;
     *  setting is not honored by this channel.
     *  &lt;/p&gt;
     *
     *  @param id The id of this Channel.
     *
     *  @param uri The uri for this Channel.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AMFConnectionChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptDefault_Text">_nc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AMFConnection</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">objectEncoding</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ObjectEncoding</span>.<span class="ActionScriptDefault_Text">AMF3</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">client</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Variables
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     */</span>
    <span class="ActionScriptDefault_Text">mx_internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_appendToURL</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Properties
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptComment">//----------------------------------
</span>    <span class="ActionScriptComment">//  netConnection
</span>    <span class="ActionScriptComment">//----------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     */</span>
    <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_nc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AMFConnection</span>;

    <span class="ActionScriptASDoc">/**
     *  Provides access to the associated AMFConnection for this Channel.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">netConnection</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AMFConnection</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_nc</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//----------------------------------
</span>    <span class="ActionScriptComment">//  useSmallmessages
</span>    <span class="ActionScriptComment">//----------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     * @private
     * If the ObjectEncoding is set to AMF0 we can&apos;t support small messages.
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">useSmallMessages</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">useSmallMessages</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_nc</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">objectEncoding</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">ObjectEncoding</span>.<span class="ActionScriptDefault_Text">AMF3</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Overridden Protected Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">connectTimeoutHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">TimerEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">shutdownAMFConnection</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">connectTimeoutHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getDefaultMessageResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">agent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MessageAgent</span>, <span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MessageResponder</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AMFConnectionMessageResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">agent</span>, <span class="ActionScriptDefault_Text">msg</span>, <span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">internalDisconnect</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rejected</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">internalDisconnect</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rejected</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">shutdownAMFConnection</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">disconnectSuccess</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rejected</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// make sure to notify everyone that we have disconnected.
</span>    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">internalConnect</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">internalConnect</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">endpoint</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_appendToURL</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_appendToURL</span>;

        <span class="ActionScriptComment">// If the AMFConnection has a non-null uri the Player will close() it automatically
</span>        <span class="ActionScriptComment">// as part of its connect() processing below. Pre-emptively close the connection while suppressing
</span>        <span class="ActionScriptComment">// NetStatus event handling to avoid spurious events.
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">connected</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NetStatusEvent</span>.<span class="ActionScriptDefault_Text">NET_STATUS</span>, <span class="ActionScriptDefault_Text">statusHandler</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">close</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NetStatusEvent</span>.<span class="ActionScriptDefault_Text">NET_STATUS</span>, <span class="ActionScriptDefault_Text">statusHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SecurityErrorEvent</span>.<span class="ActionScriptDefault_Text">SECURITY_ERROR</span>, <span class="ActionScriptDefault_Text">securityErrorHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">IOErrorEvent</span>.<span class="ActionScriptDefault_Text">IO_ERROR</span>, <span class="ActionScriptDefault_Text">ioErrorHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">syncErrorEvent</span>.<span class="ActionScriptDefault_Text">ASYNC_ERROR</span>, <span class="ActionScriptDefault_Text">asyncErrorHandler</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">try</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">connect</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">catch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// In some cases, this error does not have the URL in it (if it is a malformed
</span>            <span class="ActionScriptComment">// URL for example) and in others it does (sandbox violation).  Usually this is
</span>            <span class="ActionScriptComment">// a URL problem, so add it all of the time even though this means we&apos;ll see it
</span>            <span class="ActionScriptComment">// twice for the sandbox violation.
</span>            <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">message</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;  url: &apos;&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;&apos;&quot;</span>;
            <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">e</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">internalSend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msgResp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MessageResponder</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">// Set the global FlexClient Id.
</span>        <span class="ActionScriptDefault_Text">setFlexClientIdOnMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msgResp</span>.<span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptComment">// If MPI is enabled initialize MPI object and stamp it with client send time
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mpiEnabled</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mpii</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MessagePerformanceInfo</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MessagePerformanceInfo</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">recordMessageTimes</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">mpii</span>.<span class="ActionScriptDefault_Text">sendTime</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Date</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">getTime</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">msgResp</span>.<span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">headers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">MessagePerformanceUtils</span>.<span class="ActionScriptDefault_Text">MPI_HEADER_IN</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mpii</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">msgResp</span>.<span class="ActionScriptDefault_Text">message</span>;

        <span class="ActionScriptComment">// Finally, if &quot;Small Messages&quot; are enabled, send this form instead of
</span>        <span class="ActionScriptComment">// the normal message where possible.
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">useSmallMessages</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">message</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ISmallMessage</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">smallMessage</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ISmallMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">getSmallMessage</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">smallMessage</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">message</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">smallMessage</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">msgResp</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IAMFResponder</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Special handler for legacy AMF packet level header &quot;AppendToGatewayUrl&quot;.
     *  When we receive this header we assume the server detected that a session was
     *  created but it believed the client could not accept its session cookie, so we
     *  need to decorate the channel endpoint with the session id.
     *
     *  We do not modify the underlying endpoint property, however, as this session
     *  is transient and should not apply if the channel is disconnected and re-connected
     *  at some point in the future.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AppendToGatewayUrl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptString">&quot;&quot;</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_appendToURL</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Log</span>.<span class="ActionScriptDefault_Text">isDebug</span><span class="ActionScriptBracket/Brace">())</span>
                <span class="ActionScriptDefault_Text">_log</span>.<span class="ActionScriptDefault_Text">debug</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&apos;{0}&apos; channel will disconnect and reconnect with with its session identifier &apos;{1}&apos; appended to its endpoint url \n&quot;</span>, <span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_appendToURL</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  Called by the player when the server pushes a message.
     *  Dispatches a MessageEvent to any MessageAgents that are listening.
     *  Any ...rest args passed via RTMP are ignored.
     *
     *  @param msg The message pushed from the server.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">receive</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span>, ...<span class="ActionScriptDefault_Text">rest</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Log</span>.<span class="ActionScriptDefault_Text">isDebug</span><span class="ActionScriptBracket/Brace">())</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_log</span>.<span class="ActionScriptDefault_Text">debug</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&apos;{0}&apos; channel got message\n{1}\n&quot;</span>, <span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptDefault_Text">msg</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;

            <span class="ActionScriptComment">// If MPI is enabled write a performance summary to log
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mpiEnabled</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">try</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mpiutil</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MessagePerformanceUtils</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MessagePerformanceUtils</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_log</span>.<span class="ActionScriptDefault_Text">debug</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mpiutil</span>.<span class="ActionScriptDefault_Text">prettyPrint</span><span class="ActionScriptBracket/Brace">())</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">catch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_log</span>.<span class="ActionScriptDefault_Text">debug</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Could not get message performance information for: &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">msg</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MessageEvent</span>.<span class="ActionScriptDefault_Text">createEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MessageEvent</span>.<span class="ActionScriptDefault_Text">MESSAGE</span>, <span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">))</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Protected Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Utility method to close a AMFConnection; includes retry to deal with instances
     *  that have generated a NetStatus error on the same frame and can&apos;t be closed immediately.
     *
    protected function closeAMFConnection(nc:AMFConnection):void
    {
        var closeHelper:CloseHelper = new CloseHelper(_nc);
        closeHelper.close();
    }
    */</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  Shuts down the underlying AMFConnection for the channel.
     */</span>
    <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">shutdownAMFConnection</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SecurityErrorEvent</span>.<span class="ActionScriptDefault_Text">SECURITY_ERROR</span>, <span class="ActionScriptDefault_Text">securityErrorHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">IOErrorEvent</span>.<span class="ActionScriptDefault_Text">IO_ERROR</span>, <span class="ActionScriptDefault_Text">ioErrorHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NetStatusEvent</span>.<span class="ActionScriptDefault_Text">NET_STATUS</span>, <span class="ActionScriptDefault_Text">statusHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">syncErrorEvent</span>.<span class="ActionScriptDefault_Text">ASYNC_ERROR</span>, <span class="ActionScriptDefault_Text">asyncErrorHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">_nc</span>.<span class="ActionScriptDefault_Text">close</span><span class="ActionScriptBracket/Brace">()</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  Called when a status event occurs on the AMFConnection.
     *  Descendants must override this method.
     */</span>
    <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">statusHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">NetStatusEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  If the player rejects a AMFConnection request for security reasons,
     *  such as a security sandbox violation, the AMFConnection raises a
     *  securityError event which we dispatch as a channel fault.
     */</span>
    <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">securityErrorHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SecurityErrorEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">defaultErrorHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Channel.Security.Error&quot;</span>, <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  If there is a network problem, the AMFConnection raises an
     *  ioError event which we dispatch as a channel fault.
     */</span>
    <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ioErrorHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IOErrorEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">defaultErrorHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Channel.IO.Error&quot;</span>, <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  If a problem arises in the native player code asynchronously, this
     *  error event will be dispatched as a channel fault.
     */</span>
    <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">asyncErrorHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AsyncErrorEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">defaultErrorHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Channel.Async.Error&quot;</span>, <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Private Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Utility function to dispatch a ChannelFaultEvent at an &quot;error&quot; level
     *  based upon the passed code and ErrorEvent.
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">defaultErrorHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">code</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ErrorEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">faultEvent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelFaultEvent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ChannelFaultEvent</span>.<span class="ActionScriptDefault_Text">createEvent</span>
            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>, <span class="ActionScriptReserved">false</span>, <span class="ActionScriptDefault_Text">code</span>, <span class="ActionScriptString">&quot;error&quot;</span>, <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">text</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot; url: &apos;&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">endpoint</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;&apos;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">faultEvent</span>.<span class="ActionScriptDefault_Text">rootCause</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>;

        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_connecting</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">connectFailed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">faultEvent</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">faultEvent</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptComment">//------------------------------------------------------------------------------
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// Private Classes
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//------------------------------------------------------------------------------
</span>
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">Timer</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">TimerEvent</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flex</span>.<span class="ActionScriptDefault_Text">net</span>.<span class="ActionScriptDefault_Text">IAMFResponder</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">mx_internal</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">channels</span>.<span class="ActionScriptDefault_Text">AMFConnectionChannel</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">ChannelEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">ChannelFaultEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">MessageAgent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">MessageResponder</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">IMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">AcknowledgeMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">AsyncMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">CommandMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">messaging</span>.<span class="ActionScriptDefault_Text">messages</span>.<span class="ActionScriptDefault_Text">ErrorMessage</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">resources</span>.<span class="ActionScriptDefault_Text">IResourceManager</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">resources</span>.<span class="ActionScriptDefault_Text">ResourceManager</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">StringUtil</span>;

<span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">mx_internal</span>;

<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ResourceBundle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;messaging&quot;</span><span class="ActionScriptBracket/Brace">)]</span>

<span class="ActionScriptASDoc">/**
 *  @private
 *  This class provides the responder level interface for dispatching message
 *  results from a remote destination.
 *  The AMFConnectionChannel creates this handler to manage
 *  the results of a pending operation started when a message is sent.
 *  The message handler is always associated with a MessageAgent
 *  (the object that sent the message) and calls its &lt;code&gt;fault()&lt;/code&gt;,
 *  &lt;code&gt;acknowledge()&lt;/code&gt;, or &lt;code&gt;message()&lt;/code&gt; method as appopriate.
 */</span>
<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">AMFConnectionMessageResponder</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">MessageResponder</span> <span class="ActionScriptReserved">implements</span> <span class="ActionScriptDefault_Text">IAMFResponder</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Constructor
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  Initializes this instance of the message responder with the specified
     *  agent.
     *
     *  @param agent MessageAgent that this responder should call back when a
     *            message is received.
     *
     *  @param msg The outbound message.
     *
     *  @param channel The channel this responder is using.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AMFConnectionMessageResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">agent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MessageAgent</span>,
                                    <span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span>, <span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AMFConnectionChannel</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">agent</span>, <span class="ActionScriptDefault_Text">msg</span>, <span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(C</span><span class="ActionScriptDefault_Text">hannelEvent</span>.<span class="ActionScriptDefault_Text">DISCONNECT</span>, <span class="ActionScriptDefault_Text">channelDisconnectHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(C</span><span class="ActionScriptDefault_Text">hannelFaultEvent</span>.<span class="ActionScriptDefault_Text">FAULT</span>, <span class="ActionScriptDefault_Text">channelFaultHandler</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Variables
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     * @private
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IResourceManager</span> <span class="ActionScriptOperator">=</span>
                                    <span class="ActionScriptDefault_Text">ResourceManager</span>.<span class="ActionScriptDefault_Text">getInstance</span><span class="ActionScriptBracket/Brace">()</span>;


    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Public Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     * @private
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">amfResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">result</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IMessage</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     * @private
     */</span> 
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">amfStatus</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">info</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">status</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">info</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IMessage</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Overridden Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Called when the result of sending a message is received.
     *
     *  @param msg AMFConnectionChannel-specific message data.
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">resultHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">disconnect</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">AsyncMessage</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">syncMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">acknowledge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">AcknowledgeMessage</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">errorMsg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ErrorMessage</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultCode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;Server.Acknowledge.Failed&quot;</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;ackFailed&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultDetail</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;ackFailed.details&quot;</span>,
                    <span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span>, <span class="ActionScriptDefault_Text">AsyncMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span>;
                <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errorMsg</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//@TODO: need to add constants here
</span>            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">errorMsg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ErrorMessage</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ErrorMessage</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultCode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;Server.Acknowledge.Failed&quot;</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
                <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;noAckMessage&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultDetail</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
                <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;noAckMessage.details&quot;</span>,
                <span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">msg</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&quot;null&quot;</span> <span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span>;
            <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errorMsg</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  Called when the current invocation fails.
     *  Passes the fault information on to the associated agent that made
     *  the request.
     *
     *  @param msg AMFConnectionMessageResponder status information.
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">statusHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">disconnect</span><span class="ActionScriptBracket/Brace">()</span>;

        <span class="ActionScriptComment">// even a fault is still an acknowledgement of a message sent so pass it on...
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">AsyncMessage</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">syncMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// pass the ack on...
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ack</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AcknowledgeMessage</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AcknowledgeMessage</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">ack</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">AsyncMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">correlationId</span>;
                <span class="ActionScriptDefault_Text">ack</span>.<span class="ActionScriptDefault_Text">headers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">AcknowledgeMessage</span>.<span class="ActionScriptDefault_Text">ERROR_HINT_HEADER</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>; <span class="ActionScriptComment">// add a hint this is for an error
</span>                <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">acknowledge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ack</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// send the fault on...
</span>                <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ErrorMessage</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ErrorMessage</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// we can&apos;t find a correlation id but do have some sort of error message so just forward
</span>                <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ErrorMessage</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">errorMsg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ErrorMessage</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ErrorMessage</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultCode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;Server.Acknowledge.Failed&quot;</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;noErrorForMessage&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultDetail</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;noErrorForMessage.details&quot;</span>,
                    <span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span>, <span class="ActionScriptDefault_Text">AsyncMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span>;
                <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errorMsg</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">errorMsg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ErrorMessage</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultCode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;Server.Acknowledge.Failed&quot;</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
                <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;noAckMessage&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultDetail</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
                <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;noAckMessage.details&quot;</span>,
                <span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">msg</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&quot;null&quot;</span> <span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span>;
            <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errorMsg</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Overridden Protected Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Handle a request timeout by removing ourselves as a listener on the
     *  AMFConnection and faulting the message to the agent.
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">requestTimedOut</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">disconnect</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">statusHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">createRequestTimeoutErrorMessage</span><span class="ActionScriptBracket/Brace">())</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Protected Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Handles a disconnect of the underlying Channel before a response is
     *  returned to the responder.
     *  The sent message is faulted and flagged with the ErrorMessage.MESSAGE_DELIVERY_IN_DOUBT
     *  code.
     *
     *  @param event The DISCONNECT event.
     */</span>
    <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">channelDisconnectHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">disconnect</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">errorMsg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ErrorMessage</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ErrorMessage</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span>;
        <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span>
            <span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;deliveryInDoubt&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultDetail</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceManager</span>.<span class="ActionScriptDefault_Text">getString</span>
            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;messaging&quot;</span>, <span class="ActionScriptString">&quot;deliveryInDoubt.details&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultCode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ErrorMessage</span>.<span class="ActionScriptDefault_Text">MESSAGE_DELIVERY_IN_DOUBT</span>;
        <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errorMsg</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  Handles a fault of the underlying Channel before a response is
     *  returned to the responder.
     *  The sent message is faulted and flagged with the ErrorMessage.MESSAGE_DELIVERY_IN_DOUBT
     *  code.
     *
     *  @param event The ChannelFaultEvent.
     */</span>
    <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">channelFaultHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelFaultEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">disconnect</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">errorMsg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ErrorMessage</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">createErrorMessage</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span>;
        <span class="ActionScriptComment">// if the channel is no longer connected then we don&apos;t really
</span>        <span class="ActionScriptComment">// know if the message made it to the server.
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">connected</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">errorMsg</span>.<span class="ActionScriptDefault_Text">faultCode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ErrorMessage</span>.<span class="ActionScriptDefault_Text">MESSAGE_DELIVERY_IN_DOUBT</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptDefault_Text">agent</span>.<span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errorMsg</span>, <span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Private Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Disconnects the responder from the underlying Channel.
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">disconnect</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(C</span><span class="ActionScriptDefault_Text">hannelEvent</span>.<span class="ActionScriptDefault_Text">DISCONNECT</span>, <span class="ActionScriptDefault_Text">channelDisconnectHandler</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(C</span><span class="ActionScriptDefault_Text">hannelFaultEvent</span>.<span class="ActionScriptDefault_Text">FAULT</span>, <span class="ActionScriptDefault_Text">channelFaultHandler</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 *  @private
 *  This class provides a way to synchronize polling with a subscribe or
 *  unsubscribe request.
 *  It is constructed in response to a Consumer sending either a subscribe or
 *  unsubscribe command message.
 *  If a successfull subscribe/unsubscribe is made this responder will inform the
 *  channel which will trigger it to start/stop polling if necessary.
 *
 */</span>
<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">PollSyncMessageResponder</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">AMFConnectionMessageResponder</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Constructor
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Constructs a PollSyncMessageResponder.
     *
     *  @param agent The agent to manage polling for.
     *
     *  @param msg The subscribe or unsubscribe message for the agent.
     *
     *  @param channel The underlying Channel for the responder.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">PollSyncMessageResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">agent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MessageAgent</span>, <span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span>,
                                                <span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AMFConnectionChannel</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">agent</span>, <span class="ActionScriptDefault_Text">msg</span>, <span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Overridden Protected Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  This method is called by the player when the result of sending a message
     *  is received.
     *
     *  @param msg The response to a subscribe or unsubscribe request.
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">resultHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMessage</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">resultHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">msg</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">AsyncMessage</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">syncMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">msg</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">correlationId</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">message</span>.<span class="ActionScriptDefault_Text">messageId</span><span class="ActionScriptBracket/Brace">))</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// notify the channel
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cmd</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">CommandMessage</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">CommandMessage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">message</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cmd</span>.<span class="ActionScriptDefault_Text">operation</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">CommandMessage</span>.<span class="ActionScriptDefault_Text">SUBSCRIBE_OPERATION</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptDefault_Text">AMFConnectionChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">enablePolling</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptReserved">break</span>;

                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">CommandMessage</span>.<span class="ActionScriptDefault_Text">UNSUBSCRIBE_OPERATION</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptDefault_Text">AMFConnectionChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">disablePolling</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptReserved">break</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">// Protected Methods
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>
    <span class="ActionScriptASDoc">/**
     *  @private
     *  Handles a disconnect of the underlying Channel before a response is
     *  returned to the responder and supresses resend attempts.
     *
     *  @param event The Channel disconnect event.
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">channelDisconnectHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{}</span>

    <span class="ActionScriptASDoc">/**
     *  @private
     *  Handles a fault of the underlying Channel before a response is
     *  returned to the responder and supresses resend attempts.
     *
     *  @param event The Channel fault event.
     */</span>
    <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">channelFaultHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelFaultEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
