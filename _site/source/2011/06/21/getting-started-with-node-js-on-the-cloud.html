In my new job at salesforce.com I'm incredibly exited about getting into <a href="http://www.heroku.com">Heroku</a>, a Platform as a Service provider / Cloud Application Platform.  In a future blog post I'll provide more details on what Heroku is and how it works.  But if you are like me the first thing you want to do when learning a new technology is to take it for a test drive.  I decided to take my Heroku test drive using the <a href="http://devcenter.heroku.com/articles/node-js">recently announced Node.js support</a>.  I'm new to Node.js, but at least I know JavaScript.  Heroku also offers Ruby / Rails support but I don't know Ruby - yet.  So let me walk you through the steps I took (and that you can follow) to get started with Node.js on the Heroku Cloud.

(If you have already signed up for Heroku, installed the heroku command line client, and installed git then <a href="#step6">skip ahead to Step 6</a>.)

Step 1) <a href="http://www.heroku.com/signup">Sign up for Heroku</a>

Step 2) Install the heroku command line client

All of the Heroku management tasks are exposed through a RESTful API.  The easiest way to call those APIs is using the <a href="https://github.com/heroku/heroku">heroku open source command line</a> Ruby app.  To install the heroku command line I first had to install Ruby.  I'm on Ubuntu Linux so this process will be slightly different if you are on Windows or Mac but the <a href="http://devcenter.heroku.com/articles/quickstart">Heroku Dev Center</a> provides more information on how to do this on Windows and Mac.  On Ubuntu you can install Ruby with apt-get (or various other tools):
<pre lang="bash">
sudo apt-get install ruby
</pre>
Now <a href="http://rubygems.org/pages/download">download RubyGems</a>, unpack, and then install it:
<pre lang="bash">
sudo ruby setup.rb
</pre>
This installs the gem utility at /usr/bin/gem1.8 but I also created a symlink to it so I can run it with just the "gem" command:
<pre lang="bash">
sudo ln -s /usr/bin/gem1.8 /usr/bin/gem
</pre>
Now the heroku gem can be installed:
<pre lang="bash">
sudo gem install heroku
</pre>
Heroku should now run from the command line:
<pre lang="bash">
heroku
</pre>

You should see something like:
<pre lang="text">
Usage: heroku COMMAND [--app APP] [command-specific-options]

Primary help topics, type "heroku help TOPIC" for more details:

  auth      # authentication (login, logout)
  apps      # manage apps (create, destroy)
  ps        # manage processes (dynos, workers)
  run       # run one-off commands (console, rake)
  addons    # manage addon resources
  config    # manage app config vars
  releases  # view release history of an app
  domains   # manage custom domains
  logs      # display logs for an app
  sharing   # manage collaborators on an app

Additional topics:

  account      # manage heroku account options
  db           # manage the database for an app
  help         # list commands and display help
  keys         # manage authentication keys
  maintenance  # toggle maintenance mode
  pg           # manage heroku postgresql databases
  pgbackups    # manage backups of heroku postgresql databases
  plugins      # manage plugins to the heroku gem
  ssl          # manage ssl certificates for an app
  stack        # manage the stack for an app
  version      # display version
</pre>

Step 3) Login to Heroku via the command line

You can verify that everything is setup correctly by logging into Heroku through the heroku command line.  This will save an API key into a ~/.heroku/credentials file.  That key will be used for authenticating you on subsequent requests. Just run the following command and enter your Heroku credentials:
<pre lang="bash">
heroku auth:login
</pre>

Step 4) Install git

The git tool is used to transfer apps to Heroku.  On Ubuntu I installed it by doing:
<pre lang="bash">
sudo apt-get install git
</pre>

Step 5) Setup your SSH key

Heroku uses SSH keys to authenticate you when you push files through git.  If you don't already have a SSH key then you will need to generate one (I used ssh-keygen).

<a name="step6"></a>
Step 6) Create an app on Heroku

A new app needs to be provisioned on Heroku.  Since Heroku supports multiple application provisioning stacks you will need to tell it the stack you want to use, unless it's the default.  For Node.js we need to use the "cedar" stack which is not the default since it's still in beta.  To do that run:
<pre lang="bash">
heroku create -s cedar
</pre>
A default / random app name is automatically assigned to your app.  It will be somethingunique.herokuapp.com.  You can change the name either through the <a href="https://api.heroku.com/myapps">Heroku web admin</a> or via the command line:
<pre lang="bash">
heroku apps:rename --app somethingunique hellofromnodejs
</pre>
When the app was created your SSH key should have also been uploaded to Heroku for git access.  You can manage the keys associated with an app using the "heroku keys" commands.  Check out "heroku help keys" for more details.

Now that the app is provisioned it needs something to actually run!  So lets build a Node.js app and then upload it to Heroku.

Step 7) Install Node.js

On Ubuntu I installed Node.js through apt-get.  But first I had to add a PPA so that I could get the latest version.
<pre lang="bash">
sudo apt-add-repository ppa:jerome-etienne/neoip
sudo apt-get update
sudo apt-get install nodejs
</pre>

For other platforms, check out the <a href="http://nodejs.org/#download">Node.js Download page</a>.

Step 8) Create a Node.js app

I started by building a very simple "hello, world" Node.js app.  In a new project directory I created two new files.  First is the package.json file which specifies the app metadata and dependencies:
<pre lang="javascript">
{
  "name": "heroku_hello_world",
  "version": "0.0.1",
  "dependencies": {
    "express": "2.2.0"
  }
}
</pre>
Then the actual app itself contained in a file named web.js:
<pre lang="javascript">
var express = require('express');

var app = express.createServer(express.logger());

app.get('/', function(request, response) {
  response.send('hello, world');
});

var port = process.env.PORT || 3000;
console.log("Listening on " + port);

app.listen(port);
</pre>
This app simply maps requests to "/" to a function that sends a simple string back in the response.  You will notice that the port to listen on will first try to see if it has been specified through an environment variable and then fallback to port 3000.  This is important because Heroku can tell our app to run on a different port just by giving it an environment variable.

Step 9) Install the Node.js app dependencies

My simple Node.js app requires the <a href="http://expressjs.com/">Express Node.js library</a>.  In order to install Express, the <a href="http://npmjs.org/">Node Package Manager</a> (npm) is required.  Installing npm on Ubuntu was a bit trickey because I didn't feel the regular method followed good security practices.  So I followed the alternative install instructions by just cloning npm from github and then installed it from source:
<pre lang="bash">
git clone git://github.com/isaacs/npm.git
cd npm
sudo make install
</pre>

Now we can install the node dependencies into the local project directory.  Just run:
<pre lang="bash">
npm install .
</pre>

This uses the package.json to figure out what dependencies the app needs and then copies them into a "node_modules" directory.

Step 10) Try to run the app locally

From the command line run:
<pre lang="bash">
node web.js
</pre>

You should see "Listening on 3000" to indicate that the Node.js app is running!  Try to open it in your browser:
<a href="http://localhost:3000/">http://localhost:3000/</a>

Hopefully you will see "hello, world".  

Step 11) Create a Procfile

Heroku uses a "Procfile" to determine how to actually run your app.  Here I will just use a Procfile to tell Heroku what to run in the "web" process.  But the Procfile is really the foundation for telling Heroku how to run your stuff.  I won't go into detail here since Adam Wiggins has done a great <a href="http://blog.heroku.com/archives/2011/6/20/the_new_heroku_1_process_model_procfile/">blog post about the purpose and use of a Procfile</a>.  Create a file named "Procfile" in the project directory with the following contents:
<pre lang="javascript">
web: node web.js
</pre>

This will instruct Heroku to run the web app using the node command and the web.js file as the main app.  Heroku can also run workers (non-web apps) but for now we will just deal with web processes.

Note: Once you have a Procfile you can <a href="http://devcenter.heroku.com/articles/procfile#developing_locally_with_foreman">run your application locally using Foreman</a>.  This allows you to simulate locally how Heroku will run your app based on your Procfile.

Step 12) Store the project files in a local git repo

In order to send the app to Heroku the files must be in a local git repository.  Of course you can also put them in a remote git repo (like github.com).  To create the local git repo run the following inside of your project directory:
<pre lang="bash">
git init
</pre>

Now add the three files you've created to the git repo:
<pre lang="bash">
git add package.json Procfile web.js
</pre>

Note: Make sure you don't add the node_modules directory to the git repo!  You can have git ignore it by creating a .gitignore file containing just "node_modules".

And commit the files to the local repo:
<pre lang="bash">
git commit -m "initial commit"
</pre>

Step 13) Push the project files to Heroku

Now we need to tell git about the remote repository on Heroku which we will push the app to.  When you provisioned the app on Heroku it gave you a web URL and a git URL.  If you don't have the git URL anymore you can determine it either by running the "heroku apps" command or by navigating to the <a href="https://api.heroku.com/myapps">app on heroku.com</a>.  The git URL will be something like "git@heroku.com:somethingunique.git" where the "somethingunique" is your app's name on Heroku.  Once you have the git URL add the remote repo:
<pre lang="bash">
git remote add heroku git@heroku.com:somethingunique.git
</pre>

Note: If we had created the git repo before creating the Heroku app then the heroku command line client would have automatically added the remote repo to your git configuration.

Now you can push your app to Heroku!  Just run:
<pre lang="bash">
git push heroku master
</pre>

You should see something like:
<pre lang="text">
Counting objects: 6, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (6/6), 617 bytes, done.
Total 6 (delta 0), reused 6 (delta 0)

-----> Heroku receiving push
-----> Node.js app detected
-----> Vendoring node 0.4.7
-----> Installing dependencies with npm 1.0.8
       express@2.2.0 ./node_modules/express 
       ├── mime@1.2.2
       ├── connect@1.4.4
       └── qs@0.1.0
       Dependencies installed
-----> Discovering process types
       Procfile declares types -> web
-----> Compiled slug size is 3.1MB
-----> Launching... done, v4
       http://somethingunique.herokuapp.com deployed to Heroku

To git@heroku.com:somethingunique.git
 * [new branch]      master -> master
</pre>

Now you should be able to connect to your app in the browser!  You can also get some diagnostic information out of the heroku command line.  To see your app logs (provisioning, management, scaling, and system out messages) run:
<pre lang="bash">
heroku logs
</pre>

To see your app processes run:
<pre lang="bash">
heroku ps
</pre>

And best of all, if you want to add more Dynos* just run:
<pre lang="bash">
heroku scale web=2
</pre>
* Dynos are the isolated containers that run your web and other processes.  They are managed by the Heroku Dyno Manifold.  <a href="http://devcenter.heroku.com/articles/dynos">Learn more about Dynos</a>.

That increases the number of Dynos running the app from one to two.  Automatically Heroku will distribute the load across those two Dynos, detect dead Dynos, restart them, etc!  That is seriously easy app scalability!

There is much more to Heroku and I'll be continuing to write about it here.  But in the meantime, check out all of the great docs in the <a href="http://devcenter.heroku.com/">Heroku Dev Center</a>.  And please let me know if you have any questions or problems.  Thanks!
