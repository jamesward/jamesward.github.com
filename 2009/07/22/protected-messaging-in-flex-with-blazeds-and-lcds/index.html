
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Protected Messaging in Flex with BlazeDS and LCDS - James Ward</title>
  <meta name="author" content="James Ward">

  
  <meta name="description" content="UPDATE: BlazeDS 4 and LCDS 3.1 now have built-in support to disallow subscriptions to wildcard subtopics. Just set the following parameter on the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesward.github.com/2009/07/22/protected-messaging-in-flex-with-blazeds-and-lcds">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Ward" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-784803-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Ward</a></h1>
  
    <h2>Heroku | Java | Scala | Cloud | Open Source | Linux</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesward.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about-james-ward">About James Ward</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Protected Messaging in Flex With BlazeDS and LCDS</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-22T08:47:49-06:00" pubdate data-updated="true">Jul 22<span>nd</span>, 2009</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>UPDATE: BlazeDS 4 and LCDS 3.1 now have built-in support to <a href="https://bugs.adobe.com/jira/browse/BLZ-415">disallow subscriptions to wildcard subtopics</a>.  Just set the following parameter on the messaging destination&#8217;s server properties:</p>

<pre><code>&lt;disallow-wildcard-subtopics&gt;false&lt;/disallow-wildcard-subtopics&gt;
</code></pre>

<p>You no longer need to use the ProtectedMessagingAdapter from the code examples below in order to protect your messages.</p>

<p>One of the great things about Flex is how easy it is to set up publish and subscribe messaging using BlazeDS, LCDS, or other various server technologies.  Basically a Flex application can be either a Consumer of messages from the server, a Producer of messages to the server, or both.  The channels that are used for the actual transport can vary dramatically depending on the needs.  <a href="http://devgirl.wordpress.com/2009/07/14/livecycle-data-services-channels-and-endpoints-explained/">Here is a great blog</a> that explains the different transports.  No matter what transport / channel is used the API in Flex is the same.  If you&#8217;d like to see how to use those APIs check out <a href="http://www.jamesward.com/blog/2008/07/21/video-flex-and-java/">this video</a> I recorded.</p>

<p>Many times with pub/sub messaging the messages should only be sent to a subset of the subscribers.  There are two ways to achieve this in Flex - either using a subtopic or a selector.  Subtopics allow simple dot separated expressions such as &#8220;stocks.ADBE&#8221; which would allow Flex clients to subscribe to only messages about the ADBE stock.  A Flex client could also subscribe to wild card subtopics like &#8220;stocks.<em>&#8221; or &#8221;</em>&#8221;.  The developer usually hard codes the subtopics (if any) that an app will use.</p>

<p>Subtopics seem like a great way to send point-to-point or point-to-group messages.  To send a message to a particular client it&#8217;s as easy as setting the subtopic of the message to a special complex token - usually a generated UID or the server&#8217;s session ID.  The subscriber then subscribes to a subtopic with that particular complex token and none of the other clients listening on that messaging destination will receive that message.  Or maybe they can&#8230;</p>

<p>A malicious developer could easily determine the endpoint being used by an application.  After discovering this they could also very easily create a Flex application that subscribes to the &#8220;*&#8221; subtopic of a messaging destination.  Then the server would send them ALL of the messages on all of the subtopics for that destination.  Pretty scary stuff.  To see an example of this follow these steps:</p>

<ol>
<li><p>Open the <a href="/protectedMessaging/protectedMessaging.html">test application</a></p></li>
<li><p>Open the <a href="/protectedMessaging/HackerApp.html">hacker application</a></p></li>
<li><p>Click the send button in the test application</p></li>
<li><p>Watch the message appear in the regularDestination output panel of the hacker application</p></li>
</ol>


<p>Both panels use the same messaging API and same subtopic to send and receive messages.  However the protectedDestination uses a customized Messaging Adapter that doesn&#8217;t allow subscriptions to subtopics containing a wild card (&#8220;*&#8221;).  Here is the Java code for the ProtectedMessagingAdapter:</p>

<pre><code>package com.jamesward;

import flex.messaging.services.messaging.Subtopic;
import flex.messaging.services.messaging.adapters.ActionScriptAdapter;

public class ProtectedMessagingAdapter extends ActionScriptAdapter
{

  public boolean allowSubscribe(Subtopic subtopic)
  {
    return !(subtopic.containsSubtopicWildcard());
  }

}
</code></pre>

<p>Here is an example of how to use the new adapter in the messaging-config.xml file:</p>

<pre><code>&lt;service id="message-service" class="flex.messaging.services.MessageService"&gt;

    &lt;adapters&gt;
        &lt;adapter-definition id="protectedMessagingAdapter" class="com.jamesward.ProtectedMessagingAdapter"&gt;&lt;/adapter-definition&gt;
    &lt;/adapters&gt;

    &lt;default-channels&gt;
        &lt;channel ref="my-polling-amf"&gt;&lt;/channel&gt;
    &lt;/default-channels&gt;

    &lt;destination id="protectedDestination"&gt;
        &lt;adapter ref="protectedMessagingAdapter"&gt;&lt;/adapter&gt;
        &lt;properties&gt;
            &lt;server&gt;
                &lt;allow-subtopics&gt;true&lt;/allow-subtopics&gt;
                &lt;subtopic-separator&gt;.&lt;/subtopic-separator&gt;
            &lt;/server&gt;
        &lt;/properties&gt;
    &lt;/destination&gt;

&lt;/service&gt;
</code></pre>

<p>If you are using subtopics (or selectors) to protect messages from being sent to the wrong people then I highly recommend that you use my ProtectedMessagingAdapter or something else so that malicious hackers can&#8217;t snoop on private messages or send impostor messages.  In my demo I run both the test app and hacker app on the same server but this can be done in other ways (such as proxy servers or local apps).  Also authentication may not protect you because a malicious user might also be an authenticated user.  So the only solution is to really protect destinations from subscriptions to wild card subtopics.</p>

<p>I hope this is helpful for those using messaging.  Let me know what you think.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">James Ward</span></span>

      








  


<time datetime="2009-07-22T08:47:49-06:00" pubdate data-updated="true">Jul 22<span>nd</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/categories/blazeds/'>BlazeDS</a>, <a class='category' href='/categories/flex/'>Flex</a>, <a class='category' href='/categories/lcds/'>LCDS</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jamesward.github.com/2009/07/22/protected-messaging-in-flex-with-blazeds-and-lcds/" data-via="_JamesWard" data-counturl="http://jamesward.github.com/2009/07/22/protected-messaging-in-flex-with-blazeds-and-lcds/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2009/07/17/flex-4-example-halo-component-with-spark-skin/" title="Previous Post: Flex 4 Example - Halo Component with Spark Skin">&laquo; Flex 4 Example - Halo Component with Spark Skin</a>
      
      
        <a class="basic-alignment right" href="/2009/07/26/webinar-developing-rich-user-interfaces-on-force-com-using-adobe-flex/" title="next Post: Webinar: Developing Rich User Interfaces on Force.com Using Adobe Flex">Webinar: Developing Rich User Interfaces on Force.com Using Adobe Flex &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("_JamesWard", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/_JamesWard" class="twitter-follow-button" data-show-count="false">Follow @_JamesWard</a>
  
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101156657838073927919?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jamesward">@jamesward</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jamesward',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/12/12/heroku-jug-tour-boulder-phoenix-portland/">Heroku JUG Tour: Boulder, Phoenix, & Portland</a>
      </li>
    
      <li class="post">
        <a href="/2011/12/11/tutorial-play-framework-jpa-json-jquery-heroku/">Tutorial: Play Framework, JPA, JSON, jQuery, & Heroku</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/30/using-mongodb-for-a-java-web-apps-httpsession/">Using MongoDB for a Java Web App's HttpSession</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/30/heroku-java-user-group-tour-columbus-and-orange-county/">Heroku Java User Group Tour: Columbus and Orange County</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/29/heroku-preso-from-devoxx-2011/">Heroku Preso from Devoxx 2011</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - James Ward -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jamesward';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
