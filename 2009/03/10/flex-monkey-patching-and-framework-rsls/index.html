
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Flex Monkey Patching and Framework RSLs - James Ward</title>
  <meta name="author" content="James Ward">

  
  <meta name="description" content="The Flex Framework RSLs (Runtime Shared Libraries) are a great way to reduce download time for your Flex application. But they have an unfortunate &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesward.github.com/2009/03/10/flex-monkey-patching-and-framework-rsls">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Ward" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-784803-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Ward</a></h1>
  
    <h2>Heroku | Java | Scala | Cloud | Open Source | Linux</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesward.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about-james-ward">About James Ward</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Flex Monkey Patching and Framework RSLs</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-03-10T12:47:52-06:00" pubdate data-updated="true">Mar 10<span>th</span>, 2009</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>The Flex Framework RSLs (Runtime Shared Libraries) are a great way to reduce download time for your Flex application.  But they have an unfortunate side effect&#8230;  They break the ability to monkey patch Flex framework classes.  The reason for this is the way that the Flex compiler structures a SWF file.  Every Flex application has two frames.  You can think of a &#8220;frame&#8221; as a container for compiled ActionScript classes.  The Flex compiler puts as few things into the first frame as possible.  This is so that the loading progress bar can come up quickly (as soon as the first frame has loaded).  If you put too much on the first frame then you wouldn&#8217;t see anything happening until the whole first frame is loaded.  When you monkey patch a Flex Framework class it usually will go into the second frame.  The problem with monkey patching and the framework RSLs is that the RSLs get loaded in the first frame.  The Flash Player&#8217;s class loader won&#8217;t overwrite classes so when the preloader finishes loading and then starts loading frame two (where the monkey patched class is) it will not overwrite the class loaded from the RSL.</p>

<p>The solution is to get your monkey patched class onto frame one.  The easiest way to do this is to create a custom preloader that contains a reference to the monkey patched class.  Here&#8217;s a simple one in which my monkey patched class is mx.controls.Button:</p>

<pre><code>package
{
    import mx.controls.Button;
    import mx.preloaders.DownloadProgressBar;

    public class MyPreloader extends DownloadProgressBar
    {
        public function MyPreloader()
        {
            super();

            if (0)
            {
                var b:Button = new Button();
            }
        }

    }
}
</code></pre>

<p>Make sure you then tell your application to use your custom preloader:</p>

<pre><code>&lt;mx:application preloader="MyPreloader" xmlns:mx="http://www.adobe.com/2006/mxml"&gt;
</code></pre>

<p>Now since Button is referenced from the preloader the Flex compiler will put Button and all of its dependencies on frame one.  The monkey patched Button class will then be loaded BEFORE the RSLs thus making monkey patching work again!  But the big caveat here is that now you have a ton of stuff on frame one (Button and all its dependencies - which we are trying to leave out of our SWF in the first place).  And now the user won&#8217;t see the preloader progress bar until all of frame one is loaded - which now takes significantly longer than before.</p>

<p>While this works, it&#8217;s not ideal.  What we need is a way to shove a single class into frame one.  I&#8217;ve tried every way I can think of to do this but to no avail.  What I&#8217;d hoped would work was to put my monkey patched class but none of its dependencies into a SWC and then use the <em>-compiler.include-libraries</em> mxmlc compiler flag to shove the monkey patched class into my SWF.  But I couldn&#8217;t get compc to put just my monkey patched class into the SWC.  Here is what I tried:</p>

<pre><code>${FLEX_SDK}/bin/compc -source-path=src -debug=false -o=build/monkey.swc \
-external-library-path=${FLEX_SDK}/frameworks/libs,${FLEX_SDK}/frameworks/libs/player/9/playerglobal.swc \
-include-classes mx.controls.Button
</code></pre>

<p>But it appears that since compc sees the mx.controls.Button class in the <em>-external-library-path</em> it decides it doesn&#8217;t need to put my monkey patched Button in the SWC despite me telling it to.</p>

<p>Maybe someone else has some tricky way of getting just the monkey patched class into a SWC or onto frame one of the SWF.  Otherwise please go vote for <a href="https://bugs.adobe.com/jira/browse/SDK-19735">bug #19735</a>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">James Ward</span></span>

      








  


<time datetime="2009-03-10T12:47:52-06:00" pubdate data-updated="true">Mar 10<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/categories/flex/'>Flex</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jamesward.github.com/2009/03/10/flex-monkey-patching-and-framework-rsls/" data-via="_JamesWard" data-counturl="http://jamesward.github.com/2009/03/10/flex-monkey-patching-and-framework-rsls/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2009/03/09/flex-gumbo-sample-pretty-button-with-fxg/" title="Previous Post: Flex Gumbo Sample - Pretty Button with FXG">&laquo; Flex Gumbo Sample - Pretty Button with FXG</a>
      
      
        <a class="basic-alignment right" href="/2009/03/11/get-the-tour-de-flex-dvd/" title="next Post: Get The Tour de Flex DVD">Get The Tour de Flex DVD &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("_JamesWard", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/_JamesWard" class="twitter-follow-button" data-show-count="false">Follow @_JamesWard</a>
  
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101156657838073927919?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jamesward">@jamesward</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jamesward',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/12/12/heroku-jug-tour-boulder-phoenix-portland/">Heroku JUG Tour: Boulder, Phoenix, & Portland</a>
      </li>
    
      <li class="post">
        <a href="/2011/12/11/tutorial-play-framework-jpa-json-jquery-heroku/">Tutorial: Play Framework, JPA, JSON, jQuery, & Heroku</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/30/using-mongodb-for-a-java-web-apps-httpsession/">Using MongoDB for a Java Web App's HttpSession</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/30/heroku-java-user-group-tour-columbus-and-orange-county/">Heroku Java User Group Tour: Columbus and Orange County</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/29/heroku-preso-from-devoxx-2011/">Heroku Preso from Devoxx 2011</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - James Ward -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jamesward';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
