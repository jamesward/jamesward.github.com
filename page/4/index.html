
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>James Ward</title>
  <meta name="author" content="James Ward">

  
  <meta name="description" content="UPDATE: This event has been canceled! Sorry! Next week I&#8217;ll be presenting in Seattle at my first Force.com Developer Meetup! It starts at 6pm &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesward.github.com/page/4">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Ward" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-784803-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Ward</a></h1>
  
    <h2>Heroku | Java | Scala | Cloud | Open Source | Linux</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesward.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about-james-ward">About James Ward</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/06/15/seattle-force-com-developer-meetup-on-june-22/">Seattle Force.com Developer Meetup on June 22</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-15T08:58:34-06:00" pubdate data-updated="true">Jun 15<span>th</span>, 2011</time>
        
         | <a href="/2011/06/15/seattle-force-com-developer-meetup-on-june-22/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>UPDATE: This event has been canceled!  Sorry!</p>

<p>Next week I&#8217;ll be presenting in Seattle at my first <a href="http://www.developerforce.com/events/seattle_developer_meetup/registration.php?d=70130000000G4WO">Force.com Developer Meetup</a>!  It starts at 6pm on Wednesday, June 22.  My session will be on Flex Mobile Development. Other sessions include Force.com Platform Basics, Native iOS Development using JavaScript, and a Force.com Hands-On Lab.  It&#8217;s going to be a fun evening, so if you are in the Seattle area, then I hope to see you there!</p>

<p><a href="http://www.developerforce.com/events/seattle_developer_meetup/registration.php?d=70130000000G4WO">Get more details and register!</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/06/05/new-adventures-on-the-cloud/">New Adventures on the Cloud</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-05T17:47:25-06:00" pubdate data-updated="true">Jun 5<span>th</span>, 2011</time>
        
         | <a href="/2011/06/05/new-adventures-on-the-cloud/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I started doing professional software development almost 15 years ago I was focused on the server-side.  I started with Perl / CGI web apps - some of which are still in production today.  Then I dove into Java web development with Java Web Server 1.0, Struts, JBoss, Tomcat and many other game changing technologies.</p>

<p>In 2004 I started getting into Macromedia Flex.  I was amazed at how easy it was to retrieve and nicely render data from a Java back-end.  In 2005 I began evangelizing Flex + Java.  Following the acquisition of Macromedia by Adobe, Flex has really flourished.  Adobe Flex is now the dominant RIA technology and it has been so fun to be a part of that!</p>

<p>Over the past seven years I&#8217;ve had so many great adventures on the client-side, but when a new opportunity on the server-side came my way I couldn&#8217;t pass it up.  Starting June 6th I&#8217;ll be stepping back into the Java world to evangelize the Cloud for Salesforce.com.  I&#8217;m excited to dive into some of the emerging Java/JVM technologies like Scala, Play Framework, and Clojure!</p>

<p>This change is certainly bittersweet for me.  Flex continues to make app development easier.  With things like Android support in Flex 4.5 and iOS support coming soon, the future of Flex is bright.  I&#8217;ve been very privileged to be a part of the Flex community for the past seven years. This group of passionate and creative developers have taught me so many new things.  Learning how to do runtime bytecode modification and co-creating <a href="http://www.jamesward.com/2011/04/26/introducing-mixing-loom-runtime-actionscript-bytecode-modification/">Mixing Loom</a> has certainly been one of the highlights!</p>

<p>As I begin this new adventure on the Cloud I&#8217;m excited about what lies ahead for Flex and for the Cloud.  Both continue to help us developers build better software.  I&#8217;ve hopefully helped you learn how to build great UIs with Flex.  Now I will help you learn how to build solid and scalable back-ends on the Cloud!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/05/11/extending-air-for-android/">Extending AIR for Android</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-11T08:06:36-06:00" pubdate data-updated="true">May 11<span>th</span>, 2011</time>
        
         | <a href="/2011/05/11/extending-air-for-android/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>None</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/26/introducing-mixing-loom-runtime-actionscript-bytecode-modification/">Introducing Mixing Loom - Runtime ActionScript Bytecode Modification</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-26T08:54:03-06:00" pubdate data-updated="true">Apr 26<span>th</span>, 2011</time>
        
         | <a href="/2011/04/26/introducing-mixing-loom-runtime-actionscript-bytecode-modification/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At this year&#8217;s <a href="http://www.360flex.com/">360|Flex</a> conference in Denver, <a href="http://www.digitalprimates.net/author/codeslinger/">Mike Labriola</a> and I unveiled a new project we&#8217;ve been working on called <a href="http://github.com/MixingLoom">Mixing Loom</a>.  Our presentation was called &#8220;Planet of the AOPs&#8221; because Mixing Loom lays the foundation for true Aspect Oriented Programming (AOP) on the Flash Platform.  Mixing Loom provides Flex and ActionScript applications the hooks they need to do bytecode modification either before runtime or at runtime.  Through bytecode modification an application can apply a behavior across hierarchies of objects.  There are a number of behaviors in a typical Flex application (such as logging, security, application configuration, accessibility, and styling) that could be represented as Aspects.  Today these behaviors must either be included in every class that needs them or included way down the object hierarchy (i.e. UIComponent).  With Mixing Loom a compiled SWF can be modified (applying necessary behaviors) after it&#8217;s been compiled or as it&#8217;s starting up.</p>

<p>If you are building Flex apps and want to take advantage of AOP then Mixing Loom is probably a bit lower level than what you need.  Mixing Loom combined with <a href="http://www.as3commons.org/as3-commons-bytecode/index.html">AS3 Commons Bytecode</a> provides the foundation for AOP systems to be built on top of.  We hope that by providing developers the hooks to modify bytecode that frameworks will emerge that provide application developers higher level APIs based on AOP.  As Mike says, &#8220;Mixing Loom kicks off the Summer of AOP.&#8221;</p>

<p>If you are one of those developers who likes getting dirty with bytecode modification then you might want to check out the slides from the &#8220;Planet of the AOPs&#8221; session:</p>

<p>If you are still following along and looking for more details on how to use Mixing Loom, then keep reading.  Flex applications are broken into at least two pieces.  The first piece is the thing that displays the loading / progress bar.  That is located on the first &#8220;frame&#8221; of an application&#8217;s SWF file.  The rest of the application is on the second frame of the main SWF and possibly in other SWF files like Modules and/or Runtime Shared Libraries (RSLs).  Mixing Loom provides two ways to modify the bytecode of a running application.  First, using a custom preloader an application can modify its second frame and/or any Flex Modules before they are loaded into the VM.  The second way is to use LoomApplication and a custom preloader, which allows an application to modify its second frame, modules, and/or RSLs (even the signed Flex Framework RSLs).  Let&#8217;s walk through a simple example of an application that uses a custom preloader to modify a string that exists in its second frame.</p>

<p>Let&#8217;s take a simple object Foo that has a getBar method, which returns a string &#8220;a bar&#8221;:</p>

<pre><code>package blah
{
public class Foo
{
  public function getBar():String
  {
      return "a bar";
  }
}
}
</code></pre>

<p>And here is a simple application that just displays the results of calling an instance of Foo&#8217;s getBar method:</p>

<pre><code>&lt;s:application xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"&gt;

  &lt;fx:script&gt;
    import blah.Foo;
  &lt;/fx:script&gt;

  &lt;s:applicationcomplete&gt;
     var foo:Foo = new Foo();
     l.text = foo.getBar();
  &lt;/s:applicationcomplete&gt;

  &lt;s:label id="l"&gt;&lt;/s:label&gt;

&lt;/s:application&gt;
</code></pre>

<p>If you were to run this application as is then the Label would display &#8220;a bar&#8221; - as expected.  But to give you an idea of how to do runtime bytecode modification let&#8217;s change the &#8220;a bar&#8221; string to something else.  (BTW: If you are following along then you will need to pull down the <a href="https://github.com/MixingLoom/mixingloom-core">mixingloom-core</a> code from github and compile it on your own because we haven&#8217;t published a SWC for Mixing Loom yet.)  The thing in Mixing Loom that actually does the bytecode modification is called a &#8220;Patcher&#8221; so we will need to create one of those that searches the bytecode for a string and then replaces that string.  Before we do that, let me explain how a SWF file is structured.  Every SWF file is a series of &#8220;tags&#8221;.  There are many different tag types but the types we are interested in for bytecode modification are the ones that actually contain the ActionScript ByteCode (ABC).  This is the DoABC tag - type 82.  For a full list of SWF tags and their structures check out the <a href="http://www.adobe.com/content/dam/Adobe/en/devnet/swf/pdf/swf_file_format_spec_v10.pdf">SWF Spec</a>.  One of the tag types indicates an executable boundary called a Frame.  As a SWF file is being loaded by Flash Player it is parsing it.  When Flash Player parses a &#8220;ShowFrame&#8221; tag it knows it can load and run the preceding tags.  The code doing the bytecode modification will be running on the first frame, which means that all of the tags to do the modification and those to display the Flex preloader will have already been loaded.  That means we can&#8217;t modify those tags using this method at runtime.  But we can modify the tags on the second frame of the SWF, which will be passed to our Patcher before they have actually been loaded.</p>

<p>Here is the code for the StringModifierPatcher:</p>

<pre><code>package org.mixingloom.patcher
{
import flash.utils.ByteArray;

import org.as3commons.bytecode.tags.DoABCTag;
import org.as3commons.bytecode.util.AbcSpec;

import org.mixingloom.SwfContext;
import org.mixingloom.SwfTag;
import org.mixingloom.invocation.InvocationType;
import org.mixingloom.utils.ByteArrayUtils;

public class StringModifierPatcher extends AbstractPatcher
{
    public var originalString:String;
    public var replacementString:String;

    public function StringModifierPatcher(originalString:String, replacementString:String)
    {
        this.originalString = originalString;
        this.replacementString = replacementString;
    }

    override public function apply( invocationType:InvocationType, swfContext:SwfContext ):void
    {
        var searchByteArray:ByteArray = new ByteArray();
        AbcSpec.writeStringInfo(originalString, searchByteArray);

        var replacementByteArray:ByteArray = new ByteArray();
        AbcSpec.writeStringInfo(replacementString, replacementByteArray);

        for each (var swfTag:SwfTag in swfContext.swfTags)
        {
            if (swfTag.type == DoABCTag.TAG_ID)
            {
                swfTag.tagBody = ByteArrayUtils.findAndReplaceFirstOccurrence(swfTag.tagBody, searchByteArray, replacementByteArray);
            }
        }

        invokeCallBack();
    }

}
}
</code></pre>

<p>The StringModifierPatcher extends the Mixing Loom AbstractPatcher and takes two parameters, the originalString and the replacementString.  The StringModifierPatcher has an apply method, which will be called by Mixing Loom during application startup.  In the apply method the StringModifierPatcher creates a search ByteArray and a replacement ByteArray from the provided strings.  Then it loops through each tag from the second frame of the SWF being loaded (ignoring everything that is not a DoABC tag) and then uses Mixing Loom&#8217;s ByteArrayUtils.findAndReplaceFirstOccurrence utility to replace the first occurrence of the search ByteArray with replacement ByteArray.  Finally it notifies Mixing Loom that it is all done by calling the invokeCallBack method.  So that is the simple example of actually modifying the application, but we still need to set the hooks in the main application so that Mixing Loom can do its thing.</p>

<p>Since this example only modifies frame 2 tags (no RSLs), we can just use a custom preloader to set up the Mixing Loom hooks.  Here is the StringModifierPatcherPreloader:</p>

<pre><code>package preloader {
import org.mixingloom.managers.IPatchManager;
import org.mixingloom.patcher.StringModifierPatcher;
import org.mixingloom.preloader.AbstractPreloader;

public class StringModifierPatcherPreloader extends AbstractPreloader {
    override protected function setupPatchers(manager:IPatchManager):void {
        super.setupPatchers(manager);
        manager.registerPatcher( new StringModifierPatcher("a bar", "not really a bar") );
    }
}
}
</code></pre>

<p>The StringModifierPatcherPreloader extends Mixing Loom&#8217;s AbstractPreloader and uses the setupPatchers method to register a new patcher.  In this case the only patcher is an instance of the StringModifierPatcher that will search for the default &#8220;a bar&#8221; string and replace it with the &#8220;not really a bar&#8221; string.</p>

<p>The last thing to make this all work is to tell the main application to use the new preloader:</p>

<pre><code>&lt;s:application xmlns:fx="http://ns.adobe.com/mxml/2009" preloader="preloader.StringModifierPatcherPreloader" xmlns:s="library://ns.adobe.com/flex/spark"&gt;
</code></pre>

<p>Here is the result:</p>

<p>Exciting!  Our application code just modified itself at startup!  Now this is obviously a very trivial example but I hope it provides a basic understanding of how to use Mixing Loom as the foundation for AOP.  Let&#8217;s walk through some other examples that are more exciting (and complex).</p>

<p>For the next example let&#8217;s do something a little more AOP-ish.  There will be an XML configuration file that is loaded on startup that will specify some classes and methods to apply interceptors to.  An interceptor is simply a method call injected into the body of a method.  First, here is the FooInterceptor class:</p>

<pre><code>package
{
import mx.core.FlexGlobals;

public class FooInterceptor
{
    public static function interceptAll():void
    {
        FlexGlobals.topLevelApplication.setStyle("backgroundColor", Math.random() * 0xffffff);
    }
}
}
</code></pre>

<p>For demo purposes this interceptor is very simple - it just changes the application&#8217;s background color.  Here is the XML configuration file that the application will load on startup to determine where to apply the interceptor:</p>

<pre><code>&lt;interceptors&gt;
    &lt;interceptor&gt;
        &lt;swftag&gt;blah/Foo&lt;/swftag&gt;
        &lt;methodentryinvoker&gt;
            &lt;classname&gt;FooInterceptor&lt;/classname&gt;
            &lt;methodname&gt;interceptAll&lt;/methodname&gt;
        &lt;/methodentryinvoker&gt;
    &lt;/interceptor&gt;
&lt;/interceptors&gt;
</code></pre>

<p>In this case it is saying to only apply the interceptor to the SWF tag with the name &#8220;blah/Foo&#8221;.  In a debug version of the application the Foo class from above will be in its own SWF tag named &#8220;blah/Foo&#8221;.  The reason that the SWF tag is specified in this case is because by doing this the application won&#8217;t need to deserialize and reserialize every class.  The downside to doing things this way is that it won&#8217;t work if we create an optimized SWF where all of the frame 2 classes are contained in one SWF tag.  With some more work in AS3 Commons Bytecode we could optimize things for this kind of use case.  Volunteers?  :)  The methodEntryInvoker simply specifies the class and method name to call on method entry.  This interceptor will be added to every method, on every class in the SWF tag with the name &#8220;blah/Foo&#8221;.</p>

<p>Now for the fun part&#8230;  Here is the patcher that loads the XML config file, parses it, and then applies the interceptor:</p>

<pre><code>package patcher {
import flash.events.Event;
import flash.events.TimerEvent;
import flash.net.URLLoader;
import flash.net.URLLoaderDataFormat;
import flash.net.URLRequest;
import flash.utils.ByteArray;

import org.as3commons.bytecode.abc.AbcFile;
import org.as3commons.bytecode.abc.InstanceInfo;
import org.as3commons.bytecode.abc.LNamespace;
import org.as3commons.bytecode.abc.MethodInfo;
import org.as3commons.bytecode.abc.Op;
import org.as3commons.bytecode.abc.QualifiedName;
import org.as3commons.bytecode.abc.enum.Opcode;
import org.as3commons.bytecode.io.AbcSerializer;

import org.mixingloom.SwfContext;
import org.mixingloom.SwfTag;
import org.mixingloom.invocation.InvocationType;
import org.mixingloom.patcher.AbstractPatcher;

import org.as3commons.bytecode.io.AbcDeserializer;

public class SampleXMLPatcher extends AbstractPatcher {

    public var url:String;

    private var swfContext:SwfContext;

    public function SampleXMLPatcher(url:String) {
        this.url = url;
    }

    override public function apply( invocationType:InvocationType, swfContext:SwfContext ):void {
        if (invocationType.type == InvocationType.FRAME2) {

            this.swfContext = swfContext;

            var urlLoader:URLLoader = new URLLoader();
            urlLoader.dataFormat = URLLoaderDataFormat.TEXT;
            urlLoader.addEventListener(Event.COMPLETE, handleXMLLoad);
            urlLoader.load(new URLRequest(url));
        }
        else {
            invokeCallBack();
        }
    }

    private function handleXMLLoad(event:Event):void {
        var xmlData:XML = new XML((event.currentTarget as URLLoader).data as String);

        var swfTagName:String = xmlData.interceptor.swfTag;
        var methodEntryInvokerClassName:String = xmlData.interceptor.methodEntryInvoker.className;
        var methodEntryInvokerMethodName:String = xmlData.interceptor.methodEntryInvoker.methodName;

        var methodEntryInvokerClassQName:QualifiedName = new QualifiedName(methodEntryInvokerClassName, LNamespace.PUBLIC);
        var methodEntryInvokerMethodQName:QualifiedName = new QualifiedName(methodEntryInvokerMethodName, LNamespace.PUBLIC);

        for each (var swfTag:SwfTag in swfContext.swfTags) {
            if (swfTag.name == swfTagName) {

                // skip the flags
                swfTag.tagBody.position = 4;

                var abcStartLocation:uint = 4;
                while (swfTag.tagBody.readByte() != 0) {
                    abcStartLocation++;
                }
                abcStartLocation++; // skip the string byte terminator

                swfTag.tagBody.position = 0;

                var abcDeserializer:AbcDeserializer = new AbcDeserializer(swfTag.tagBody);

                var abcFile:AbcFile = abcDeserializer.deserialize(abcStartLocation);

                for each (var instanceInfo:InstanceInfo in abcFile.instanceInfo) {

                    for each (var methodInfo:MethodInfo in instanceInfo.methodInfo) {
                        var startIndex:uint = 0;
                        for each (var op:Op in methodInfo.methodBody.opcodes) {
                            startIndex++;
                            if (op.opcode === Opcode.pushscope) {
                                break;
                            }
                        }

                        var findOp:Op = new Op(Opcode.findpropstrict, [methodEntryInvokerClassQName]);
                        var getOp:Op = new Op(Opcode.getproperty, [methodEntryInvokerClassQName]);
                        var callOp:Op = new Op(Opcode.callproperty, [methodEntryInvokerMethodQName, 0]);

                        methodInfo.methodBody.opcodes.splice(startIndex, 0, findOp, getOp, callOp, new Op(Opcode.pop));
                    }
                }

                var abcSerializer:AbcSerializer = new AbcSerializer();
                var modifiedBytes:ByteArray = new ByteArray();
                modifiedBytes.writeBytes(swfTag.tagBody, 0, abcStartLocation);
                modifiedBytes.writeBytes(abcSerializer.serializeAbcFile(abcFile));

                swfTag.tagBody = modifiedBytes;
            }
        }

        invokeCallBack();
    }
}
}
</code></pre>

<p>The constructor for this patcher takes a URL, which is used to specify the XML config file.  Then in the apply method, if the invocation type is &#8220;FRAME2&#8221; (meaning the patcher is being applied to the SWF tags on the second frame of the loading SWF) then it uses URLLoader to load the XML config file.  Notice that URLLoader is used, not HTTPService.  That is because anything that goes into a patcher is put on the first frame of the SWF and if HTTPService was used here, then there would be a ton of additional classes (dependencies) that would need to also be moved to the first frame.  While technically this would work, it&#8217;s not a good practice because the more that is on the first frame, the longer the user has to wait before the preloader shows up (remember: all of the frame must be transferred across the network before the frame is loaded into the VM).  If the invocation type is not &#8220;FRAME2&#8221; then the invokeCallBack method is called to tell Mixing Loom that this patcher is done with the current invocation.  Side note: patchers can block for as long as they want.  Nothing moves forward in Mixing Loom until a patcher calls the invokeCallBack method.</p>

<p>When the data for the XML file arrives it is parsed using the E4X library.  Then new QualifiedName instances are created based on the interceptor&#8217;s class and method names.  Now the SWF tag with the name specified in the XML file is processed.  First it is deserialized by AS3 Commons Bytecode.  This provides an object representation of the underlying ABC code contained in the SWF tag.  Then for every class and method the interceptor is applied at the beginning of the method.  Kinda.  There are a few operations that must happen at the very beginning of the method.  For each method being intercepted we need to move past the &#8220;pushscope&#8221; opcode before we can insert new opcodes.  Then four new opcodes are spliced into the array of opcodes for the method: findpropstrict, getproperty, callproperty, and pop.  Those four opcodes are the ABC equivalent of calling the static method on the specified interceptor class.  In this case the rest of the opcodes in the method will be left alone.  Finally the ABC is recreated using AS3 Commons Bytecode and the original SWF tag is overwritten and the invokeCallBack method is called.</p>

<p>Just like before we need a custom preloader to register the patchers:</p>

<pre><code>package preloader {
import org.mixingloom.managers.IPatchManager;
import org.mixingloom.preloader.AbstractPreloader;

import patcher.SampleXMLPatcher;

public class SampleXMLPatcherPreloader extends AbstractPreloader {

        override protected function setupPatchers(manager:IPatchManager):void {
            super.setupPatchers(manager);
            manager.registerPatcher( new SampleXMLPatcher("interceptors.xml"));
        }
    }
}
</code></pre>

<p>Notice that a new instance of the SampleXMLPatcher is created and given the URL to the interceptor XML file.  Here is a little test application containing a button that calls Foo&#8217;s getBar method every time it&#8217;s clicked:</p>

<pre><code>&lt;s:application xmlns:fx="http://ns.adobe.com/mxml/2009" preloader="preloader.SampleXMLPatcherPreloader" xmlns:s="library://ns.adobe.com/flex/spark"&gt;

    &lt;fx:script&gt;
        import blah.Foo;
        import FooInterceptor; FooInterceptor;
    &lt;/fx:script&gt;


    &lt;s:button top="20" horizontalcenter="0" fontsize="32" label="call foo.getBar()"&gt;
        &lt;s:click&gt;
                var foo:Foo = new Foo();
                foo.getBar();
        &lt;/s:click&gt;
    &lt;/s:button&gt;

&lt;/s:application&gt;
</code></pre>

<p>Notice that since there wasn&#8217;t a reference anywhere else to the FooInterceptor we had to include one manually otherwise it will not exist in the compiled SWF.  Here is a demo of that application:</p>

<p>Well, that was fun!  And I hope you can see how Mixing Loom can be the foundation for doing AOP in Flex / ActionScript!  But before I let you go I want to show you one more crazy thing we can do with Mixing Loom.  Patchers can do just about anything they want since Mixing Loom provides hooks to modify the second frame, RSLs, and Modules.  For instance, say there is a private method or property in the Flex framework that you need access to.  One option is to use Monkey Patching to replace that class with one that you maintain.  This is not a very maintainable way to get access to something that is private.  Using Mixing Loom you can simply patch the class at runtime.  Here is a simple (but impractical) example&#8230;  The spark.components.Application class has a private method called &#8220;debugTickler&#8221; on it.  Using the <a href="https://github.com/MixingLoom/mixingloom-patchers/tree/master/RevealPrivatesPatcher">RevealPrivatesPatcher</a> from Mixing Loom we can make that method public at runtime.  First extend the base RevealPrivatesPatcher class and tell it only to apply the patcher on the &#8220;spark_&#8221; RSL:</p>

<pre><code>package {
import org.mixingloom.SwfContext;
import org.mixingloom.invocation.InvocationType;
import org.mixingloom.patcher.RevealPrivatesPatcher;

public class MyRevealPrivatesPatcher extends RevealPrivatesPatcher {

    override public function apply( invocationType:InvocationType, swfContext:SwfContext ):void {
        if ((invocationType.type == InvocationType.RSL) &amp;&amp; (invocationType.url.indexOf("spark_") &gt;= 0)) {
            super.apply(invocationType, swfContext);
        }
        else {
            invokeCallBack();
        }
    }
}
}
</code></pre>

<p>Then create a custom preloader that registers a new instance of MyRevealPrivatesPatcher and tells it to reveal the &#8220;spark.components:Application&#8221; class and the &#8220;debugTickler&#8221; method:</p>

<pre><code>package preloader {
import org.mixingloom.managers.IPatchManager;
import org.mixingloom.preloader.AbstractPreloader;

    public class RevealPrivatesPatcherPreloader extends AbstractPreloader {

        override protected function setupPatchers( manager:IPatchManager ):void {
            super.setupPatchers( manager );
            manager.registerPatcher( new MyRevealPrivatesPatcher("spark.components:Application", "debugTickler") );
        }

    }
}
</code></pre>

<p>Finally, use the LoomApplication and the custom preloader in order to have the hooks to patch RSLs:</p>

<pre><code>&lt;ml:loomapplication preloader="preloader.RevealPrivatesPatcherPreloader" xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:ml="library://ns.mixingloom.org/flex/spark" xmlns:s="library://ns.adobe.com/flex/spark"&gt;

    &lt;ml:applicationcomplete&gt;
            try {
                this['debugTickler']();
                l.text = "Yeah.  We just modified an RSL at runtime.";
            } catch (e:Error) {
                l.text = "booo";
            }
    &lt;/ml:applicationcomplete&gt;

    &lt;s:label text="nothing happened." id="l"&gt;&lt;/s:label&gt;

&lt;/ml:loomapplication&gt;
</code></pre>

<p>Notice that we can&#8217;t use the dot syntax &#8220;this.debugTickler()&#8221; to call the method since the compiler won&#8217;t let us do that.  Instead we have to use the object key syntax &#8220;this<a href="">&#8216;debugTickler&#8217;</a>&#8221; in order to make the method call.  Now watch as Mixing Loom&#8217;s magic wand modifies a signed Flex Framework RSL right before your very eyes:</p>

<p>Fun stuff!!!  And there is more to come!  We are working on ways to also modify the first frame of the SWF and to modify a SWF pre-runtime.  But now it&#8217;s your turn!  All of the code for everything you&#8217;ve seen here, as well as some other demos, and goodies is <a href="https://github.com/MixingLoom">all on github</a>.  We&#8217;d love to see the community create some interesting and useful patchers!  So fork away and have fun!  Let me know if you have any questions.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/15/using-an-embedded-wsdl-with-flexs-webservice-api/">Using an Embedded WSDL With Flex&#8217;s WebService API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-15T07:42:53-06:00" pubdate data-updated="true">Apr 15<span>th</span>, 2011</time>
        
         | <a href="/2011/04/15/using-an-embedded-wsdl-with-flexs-webservice-api/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I was helping a customer figure out how to use an embedded WSDL with Flex&#8217;s WebService API.  One scenario in which this is needed is when the actual WSDL is not available at runtime.  In this case the application must contain the WSDL instead of request it at runtime.  The Flex WebService API today only supports loading the WSDL over the network at runtime.  Beginning in Flash Builder 4 the Service wizard generate code that internally use the WebService API.  So no matter how you integrate with a SOAP Web Service in Flex, you need the WSDL accessible via a URL at runtime.  This wasn&#8217;t possible for the customer I was working with so we figured out a way to actually embed the WSDL into the application.  Here is what we did&#8230;</p>

<p>I used my <a href="http://www.jamesward.com/census2">Census</a> SOAP Service as a simple service to test this with.  In this case, my WSDL is publicly available at: <a href="http://www.jamesward.com/census2-tests/services/CensusSOAPService?wsdl">http://www.jamesward.com/census2-tests/services/CensusSOAPService?wsdl</a></p>

<p>First, I created a new Flex project and saved the WSDL into the src dir of the project.  I built a simple test program using the WebService API directly:</p>

<pre><code>&lt;s:application xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"&gt;

    &lt;fx:declarations&gt;
        &lt;s:webservice wsdl="http://www.jamesward.com/census2-tests/services/CensusSOAPService?wsdl" id="ws"&gt;&lt;/s:webservice&gt;
    &lt;/fx:declarations&gt;

    &lt;s:applicationcomplete&gt;
        ws.getElements(0, 50);
    &lt;/s:applicationcomplete&gt;

    &lt;s:datagrid width="100%" dataprovider="{ws.getElements.lastResult}" height="100%"&gt;&lt;/s:datagrid&gt;

&lt;/s:application&gt;
</code></pre>

<p>Then I ran the application in Chrome with the Network view open in the Chrome Developer Tools panel.  This indicated that, just as expected, the WSDL is used at runtime:
<img src="http://www.jamesward.com/wp/uploads/2011/04/flex_wsdl_webservice.png" alt="" /></p>

<p>Next I had a look around the <em>WebService</em> source code (available in <FLEX_SDK>/frameworks/projects/rpc/src/mx/rpc/soap) and discovered there is a <em>loadWSDL</em> method that can be overwritten to handle the embedded loading of the WSDL instead of the default network loading of the WSDL.  So I created a new class that extends the base <em>WebService</em> class, embeds the WSDL file, and overrides the <em>loadWSDL</em> method:</p>

<pre><code>package
{
    import mx.core.ByteArrayAsset;
    import mx.core.mx_internal;
    import mx.rpc.events.WSDLLoadEvent;
    import mx.rpc.soap.mxml.WebService;
    import mx.rpc.wsdl.WSDL;

    use namespace mx_internal;

    public dynamic class MyWebService extends WebService
    {
        [Embed(source="CensusSOAPService.xml", mimeType="application/octet-stream")]
        private static const WSDL_CLASS:Class;

        public function MyWebService(destination:String=null)
        {
            super(destination);
            loadWSDL();
        }

        override public function loadWSDL(uri:String=null):void
        {
            var thing:Object = new WSDL_CLASS();
            var baa:ByteArrayAsset = (thing as ByteArrayAsset);
            var xml:String = baa.readUTFBytes(baa.length);

            deriveHTTPService();

            var wsdlLoadEvent:WSDLLoadEvent = WSDLLoadEvent.createEvent(new WSDL(new XML(xml)));
            wsdlHandler(wsdlLoadEvent);
        }
    }
}
</code></pre>

<p>In the regular <em>WebService</em> class, setting the <em>wsdl</em> property will trigger the <em>loadWSDL</em> method, but since we are embedding the WSDL, we must manually call the <em>loadWSDL</em> method.  I do that in the constructor.</p>

<p>Embedded assets become a class, so first an instance of that class must be instantiated as a <em>ByteArrayAsset</em> (the default type for files embedded with the application/octet-stream mimeType).  Then the instance is read into a string.  Then the <em>deriveHTTPService</em> method is called to set up the underlying <em>HTTPService</em>&#8217;s channel information.  Finally, we create a <em>WSDL</em> object from the <em>XML</em> that was read from the <em>ByteArrayAsset</em>, create a new <em>WSDLLoadEvent</em> with the <em>WSDL</em>, and call the <em>wsdlHandler</em> method, passing it the <em>wsdlLoadEvent</em>.  This essentially is doing the same thing as the original <em>WebService</em> class, but now doing it without the network request.</p>

<p>I can now switch my test application to use my extension to WebService instead of the original one:</p>

<pre><code>    &lt;fx:declarations&gt;
        &lt;local:mywebservice xmlns:local="*" id="ws"&gt;&lt;/local:mywebservice&gt;
    &lt;/fx:declarations&gt;
</code></pre>

<p>Now when I run the application and monitor the network activity I no longer see the WSDL being requested at runtime!  So everything works when using the <em>WebService</em> API directly.  However, the customer I was working with was using the Service wizard in Flash Builder.  So we needed to figure out how to get the generated code to use the new <em>WebService</em> extension instead of the original <em>WebService</em> class.  I went through the Data Wizards and had it generate the client-side stubs for my Census SOAP Service.  This created a <em>CensusSOAPService</em> class that extends the generated <strong>Super_CensusSOAPService<em> class.  The </em>CensusSOAPService_ is intended to give us a place to make modifications to the generated stuff, while the </strong>Super_CensusSOAPService<em> class is not supposed to be modified because it will be overwritten if we refresh the service.  Looking in the __Super_CensusSOAPService</em> class I discovered that the <em>WebService</em> instance is being created directly in the constructor:</p>

<pre><code>    public function _Super_CensusSOAPService()
    {
        // initialize service control
        _serviceControl = new mx.rpc.soap.mxml.WebService();

        // rest of method omitted
    }
</code></pre>

<p>These are the kinds of things that really make you wish the Flex framework used dependency injection because we need to set <strong>serviceControl<em> from the </em>CensusSOAPService_ class.  So we thought&#8230;  Alright, this is not ideal but we can just copy the contents of the </strong>Super_CensusSOAPService<em>&#8217;s constructor into </em>CensusSOAPService<em>&#8217;s constructor, replace the line that instantiates the </em>WebService<em>, have it instantiate </em>MyWebService<em> instead, and then just not call </em>super()<em>.  We gave it a try and for some reason kept getting __serviceControl</em> set as a <em>WebService</em> not <em>MyWebService</em>.  WTF?  It made no sense until we found this little gem in the <a href="http://help.adobe.com/en_US/flex/using/WS2db454920e96a9e51e63e3d11c0bf67eed-7fff.html">Flex docs</a>:
<em>&#8220;If you define the constructor, but omit the call to super(), Flex automatically calls super() at the beginning of your constructor.&#8221;</em>
Now it all made sense!  Since we didn&#8217;t call <em>super()</em>, Flex conveniently inserted a <em>super()</em> call for us!  Fun.  So we had to figure out a way to convince the Flex compiler that we were going to call <em>super()</em>, but then not call it.</p>

<pre><code>if (0)
{
    super();
}
</code></pre>

<p>Voila!  Now the <em>CensusSOAPService</em>&#8217;s constructor sets <strong>serviceControl<em> to a new instance of </em>MyWebService_ and </strong>Super_CensusSOAPService_ doesn&#8217;t get the chance to mess that up.</p>

<p>We tested the new <em>CensusSOAPService</em> and everything worked perfectly!</p>

<p>I hope that helps some of you who are using the Flex WebService API.  Let me know if you have any questions.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/11/tour-de-mobile-flex-on-ios/">Tour De Mobile Flex on iOS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-11T11:03:04-06:00" pubdate data-updated="true">Apr 11<span>th</span>, 2011</time>
        
         | <a href="/2011/04/11/tour-de-mobile-flex-on-ios/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Flex support for iOS apps is <a href="http://eon.businesswire.com/news/eon/20110410005103/en/Flash-Platform/Flex/Flash-Builder">coming in June 2011</a>!!!  Here&#8217;s a little sneak peak of the <a href="http://flex.org/tourmobile">Tour de Mobile Flex app</a> running on iOS:</p>

<p>These are exciting times for developers!  With Flex we will be able to use one technology and one code base to build apps for iOS, Android, Playbook, Windows, Mac, Linux, IE, Firefox, Chrome, Safari, etc!  Fun times!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/11/building-mobile-apps-with-flex-4-5/">Building Mobile Apps With Flex 4.5</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-11T06:54:36-06:00" pubdate data-updated="true">Apr 11<span>th</span>, 2011</time>
        
         | <a href="/2011/04/11/building-mobile-apps-with-flex-4-5/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Now that Flex 4.5 has <a href="http://www.adobe.com/products/flex/mobile/">officially been announced</a> I wanted to show just how easy it is to start building mobile apps with Flex:</p>

<p>Very fun stuff!  Let me know what you think.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/04/next-week-in-denver-360flex-and-flex-camp-2011/">Next Week in Denver: 360|Flex and Flex Camp 2011</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-04T08:06:37-06:00" pubdate data-updated="true">Apr 4<span>th</span>, 2011</time>
        
         | <a href="/2011/04/04/next-week-in-denver-360flex-and-flex-camp-2011/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Next week I&#8217;ll be presenting at two great Flex events here in Denver, Colorado.  On Sunday April 10th, <a href="http://gregsramblings.com/">Greg Wilson</a> and I will be presenting an &#8220;Intro to Building Mobile Apps&#8221; at <a href="http://www.360flex.com/">360|Flex</a>.  Then on Tuesday April 12 <a href="http://www.digitalprimates.net/author/codeslinger/">Mike Labriola</a> and I will leave the world of Flex bewildered and befuddled when we present &#8220;Planet of the AOPs&#8221; (also at 360|Flex).  And on Thursday April 14 I&#8217;ll be presenting &#8220;Building Cross-Device Apps with Flex&#8221; at the <a href="http://ria5280.org/calendar/event/2011/4/14/251740">Denver Flex Camp</a>.  It&#8217;s going to be a really fun week and I hope to see you there!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/24/planet-of-the-aops-at-360flex/">Planet of the AOPs at 360|Flex</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-24T08:09:06-06:00" pubdate data-updated="true">Mar 24<span>th</span>, 2011</time>
        
         | <a href="/2011/03/24/planet-of-the-aops-at-360flex/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This year at <a href="http://www.360flex.com/">360|Flex</a> in Denver I&#8217;ll be co-presenting a session with <a href="http://www.digitalprimates.net/author/codeslinger/">Mike Labriola</a> called &#8221;<a href="http://www.360flex.com/schedule/">Planet of the AOPs</a>&#8221;.  What is the Planet of the AOPs?  Let me give you a little hint&#8230;</p>

<pre><code>public class Foo {
  private function getPrivateBar():String {
    return "private bar";
  }
}





var foo:Foo = new Foo();
foo['getPrivateBar']();
</code></pre>

<p>Yup!  It&#8217;s gonna be fun!  The session will be on Tuesday April 12th at 2:50pm.  Hope to see you there!</p>

<p>Also, Mike and I are doing a <a href="http://www.360flex.com/blog/2011/03/360flex-2011-speaker-chat-michael-labriola/">360|Flex speaker chat</a> today at 11am (MDT).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/09/my-upcoming-flex-sessions-in-atlanta-devnexus-and-atlanta-flex-user-group/">My Upcoming Flex Sessions in Atlanta - DevNexus and Atlanta Flex User Group</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-09T10:53:04-07:00" pubdate data-updated="true">Mar 9<span>th</span>, 2011</time>
        
         | <a href="/2011/03/09/my-upcoming-flex-sessions-in-atlanta-devnexus-and-atlanta-flex-user-group/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In a few weeks I&#8217;ll be speaking in Atlanta at <a href="http://www.devnexus.com/">DevNexus</a> and at the <a href="http://www.meetup.com/atlflex">Atlanta Flex User Group</a>.  On March 21, 2011 at DevNexus I have two sessions:</p>

<ul>
<li><p><a href="http://www.devnexus.com/s/presentations#1156">AS34J - ActionScript for Java Developers</a></p></li>
<li><p><a href="http://www.devnexus.com/s/presentations#1155">Rapid Mobile &amp; Tablet App Development with Spring and Flex</a></p></li>
</ul>


<p>On March 22, 2011 at the Atlanta Flex User Group I will be presenting about <a href="http://www.meetup.com/atlflex/events/16734337/">Flex 4.5 - The Non-Mobile New Features</a>.</p>

<p>I hope to see you at DevNexus and at the Atlanta Flex User Group!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/5/">&larr; Older</a>
    
    <a href="/archives">Blog Archives</a>
    
    <a class="next" href="/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("_JamesWard", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/_JamesWard" class="twitter-follow-button" data-show-count="false">Follow @_JamesWard</a>
  
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101156657838073927919?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/jamesward">@jamesward</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jamesward',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/12/12/heroku-jug-tour-boulder-phoenix-portland/">Heroku JUG Tour: Boulder, Phoenix, & Portland</a>
      </li>
    
      <li class="post">
        <a href="/2011/12/11/tutorial-play-framework-jpa-json-jquery-heroku/">Tutorial: Play Framework, JPA, JSON, jQuery, & Heroku</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/30/using-mongodb-for-a-java-web-apps-httpsession/">Using MongoDB for a Java Web App&#8217;s HttpSession</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/30/heroku-java-user-group-tour-columbus-and-orange-county/">Heroku Java User Group Tour: Columbus and Orange County</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/29/heroku-preso-from-devoxx-2011/">Heroku Preso from Devoxx 2011</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - James Ward -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jamesward';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
