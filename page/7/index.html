
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>James Ward</title>
  <meta name="author" content="James Ward">

  
  <meta name="description" content="The new component / skin separation in Flex 4 (the Spark Architecture) is pretty nifty. But if you want to add a configurable style to a skin then &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesward.github.com/page/7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Ward" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-784803-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Ward</a></h1>
  
    <h2>Heroku | Java | Scala | Cloud | Open Source | Linux</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesward.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about-james-ward">About James Ward</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/30/how-to-define-styles-on-skins-in-flex-4/">How to Define Styles on Skins in Flex 4</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-30T07:49:38-06:00" pubdate data-updated="true">Jul 30<span>th</span>, 2010</time>
        
         | <a href="/2010/07/30/how-to-define-styles-on-skins-in-flex-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The new component / skin separation in Flex 4 (the Spark Architecture) is pretty nifty.  But if you want to add a configurable style to a skin then that style must be defined on the component.  For instance if you want to add a backgroundColor style to a Button skin then you need to first create a new Button component with the style on it:</p>

<pre><code>package
{
import spark.components.Button;

[Style(name="backgroundColor", type="uint", format="Color")]
public class SButton extends Button
{

}
}
</code></pre>

<p>Then create a new Button skin that uses the style:</p>

<pre><code>&lt;s:sparkskin xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"&gt;

  &lt;fx:script&gt;
    import mx.utils.ColorUtil;
  &lt;/fx:script&gt;

  &lt;s:states&gt;
    &lt;s:state name="up"&gt;&lt;/s:state&gt;
    &lt;s:state name="over"&gt;&lt;/s:state&gt;
    &lt;s:state name="down"&gt;&lt;/s:state&gt;
  &lt;/s:states&gt;

  &lt;s:rect width="100%" height="100%"&gt;
    &lt;s:fill&gt;
      &lt;s:solidcolor color="{getStyle('backgroundColor')}" color.over="{ColorUtil.adjustBrightness2(getStyle('backgroundColor'), 64)}" color.down="{ColorUtil.adjustBrightness2(getStyle('backgroundColor'), -32)}"&gt;&lt;/s:solidcolor&gt;
    &lt;/s:fill&gt;
  &lt;/s:rect&gt;

  &lt;s:label paddingright="3" paddingbottom="3" paddingleft="3" id="labelDisplay" paddingtop="6"&gt;&lt;/s:label&gt;

&lt;/s:sparkskin&gt;
</code></pre>

<p>Then you can use the new Button and skin:</p>

<pre><code>  &lt;sbutton skinclass="SButtonSkin" backgroundcolor="#ff0000" label="backgroundColor = #ff0000"&gt;&lt;/sbutton&gt;
  &lt;sbutton skinclass="SButtonSkin" backgroundcolor="#0000ff" label="backgroundColor = #0000ff"&gt;&lt;/sbutton&gt;
</code></pre>

<p>The reason that we had to create a new base class just to hold the style is because there would be no other way to set the style in MXML.  We could have set the style via CSS or setStyle.  Button does not have a style named &#8220;backgroundColor&#8221; so if we hadn&#8217;t created SButton and tried to just set a backgroundColor property on a Button instance via MXML, the compiler would have thrown an error.</p>

<p>So I (with the help of <a href="http://frishy.blogspot.com/">Ryan Frishberg</a> and <a href="http://blogs.digitalprimates.net/codeslinger/">Mike Labriola</a>) came up with a nifty little way to set styles on skins without having to create new base classes to hold the styles.  The idea is that styles should be defined on the skins and you can use a property on the base components to set those styles via MXML.  To make it happen I had to Monkey Patch a property named &#8220;style&#8221; onto UIComponent.  In the setter for that style I just parse a string of HTML-ish styles and  call setStyle.  The cool thing is that I&#8217;m calling setStyle on the component but since skins inherit the styles of their host component the skin gets the styles.  This also means that the styles don&#8217;t really need to be defined on the skins.  Just used in the skins.  Using the example above to set the backgroundColor on the Button I could just do:</p>

<pre><code>  &lt;s:button skinclass="SButtonSkin" style="backgroundColor: #ff0000" label="backgroundColor = #ff0000"&gt;&lt;/s:button&gt;
</code></pre>

<p>I didn&#8217;t need a new Button class just to set the backgroundColor style.  Here is a more complex example with more styles on the skin:</p>

<p>All of those buttons are using the same skin and the base Spark Button!  The code for this example is <a href="http://github.com/jamesward/Styles4Skins">on github</a>.  So check it out, fork it, and have fun.  Let me know if you have any questions.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/26/building-client-cloud-apps-with-flash-builder-for-force-com/">Building Client / Cloud Apps With Flash Builder for Force.com</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-26T12:15:25-06:00" pubdate data-updated="true">Jul 26<span>th</span>, 2010</time>
        
         | <a href="/2010/07/26/building-client-cloud-apps-with-flash-builder-for-force-com/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have a theory.  The majority of people who use enterprise software today use old school Client / Server apps.  We&#8217;ve been trying to move these apps to the web for more than ten years.  The ease of deployment of web apps is a clear motivator.  Yet the client capabilities of the plain old web browser have not been sufficient for many apps to make the leap.  This is why I love Flex and the Flash Platform.  It provides a way to use web technologies and the web deployment model but adds many of the critical things needed for mission critical apps that people use all day long.</p>

<p>But no one wants to go back to the Client / Server architecture.  We want to embrace Cloud Computing architectures but not lose the client capabilities.  What we really need is the Client / Cloud architecture.  We need a web deployment model that provides ease of deployment but also the ability to install applications on our desktops and mobile devices.</p>

<p>This is why I&#8217;m so excited about the new <a href="http://developer.force.com/flashbuilder">Adobe Flash Builder for Force.com</a>.  In a nutshell this is a tool that Adobe and Salesforce.com built together to enable developers to build great software using Flex for the UI and Force.com for the Cloud back-end.  It&#8217;s a wonderful combination of technologies that will help many Client / Server apps make the switch to Client / Cloud.</p>

<p>Applications created with Flash Builder for Force.com can be run in the browser, on the desktop, and on mobile devices.  These applications can be assembled from the hundreds of Flex components that are out there (check out many of them in <a href="http://flex.org/tour">Tour de Flex</a>).</p>

<p>Check out this video to see how to use Flash Builder for Force.com to build a simple app:</p>

<p>As you can see, it&#8217;s very easy to get started.  But I wanted to go a step further and try to build something real&#8211;something that shows a genuine use case for extending beyond the out-of-the-box Salesforce.com UI.  I wanted to keep it really simple so that I could post the code here.  What I came up with is this (in user story form):</p>

<ul>
<li><p>As a Salesforce.com user I want to take a photo, using my phone, of one of my contacts so that the photo can be saved to their contact record for future reference.</p></li>
<li><p>As a Salesforce.com user I want to see photos I&#8217;ve taken of my contacts so that I can be reminded of what they look like.</p></li>
</ul>


<p>Simple enough.  So here is what I came up with:</p>

<p>To build these two apps I first downloaded and installed <a href="https://www.developerforce.com/events/flashbuilder/registration.php">Flash Builder for Force.com</a>.  I used the <a href="http://www.adobe.com/go/airbetasignup">Adobe AIR for Android prerelease</a> to build the mobile app.  Here is how I created these apps.</p>

<p>First I added a new field to Contact to store the photo.  Salesforce.com doesn&#8217;t have a binary field so I used a large text field (32k limit).  I&#8217;ll store the photo Base64 encoded.</p>

<p>Then in Salesforce.com I saved my enterprise.wsdl file. Check out a <a href="http://wiki.developerforce.com/index.php/Demo_Building_Desktop_Client_for_the_Cloud">great video from Dave Carroll</a> to see how to do this.</p>

<p>Now in Flash Builder for Force.com I created a new Force.com Flex Project for the mobile app.  If you do this on your own and want to run on a mobile device then you will need to overlay the AIR for Android SDK on top of a Flex 4.1 SDK.  Select Desktop Application as the app type.  Replace WindowedApplication with just Application.  And replace the F3DesktopApplication with F3WebApplication since F3DesktopApplication uses APIs that are not available on AIR for Android.  (BTW: Flash Builder, Flex, and Force.com Flex Projects do not officially support mobile deployment yet.  It works but there is no support and no guarantees.)  If you are building a standard Web Application or Desktop Application then you can just leave the generated code as is.</p>

<p>Using the Data/Services wizard I connected to Salesforce.com using my enterprise.wsdl file.  After the services and value objects have been generated I modified the Contact object and added a Bindable account property.  The generated application already included the F3DesktopApplication Declaration used to connect to Salesforce.  Due to an incompatibility with that API and AIR for Android I switched it to use F3WebApplication.  In F3WebApplication&#8217;s loginComplete event handler I query Salesforce.com for Accounts and then Contacts, associate contacts with their account, and then store the contacts:</p>

<pre><code>app.wrapper.query("select Id, Name from Account", new AsyncResponder(function(data:ArrayCollection, token:Object):void {
    accounts = data;
    app.wrapper.query("select Id, AccountId, FirstName, LastName, Phone, MobilePhone, Email, Title, Department, MailingCity, photoData__c from Contact", new AsyncResponder(function(data:ArrayCollection, token:Object):void {
        for each (var contact:Contact in data)
        {
            for each (var account:Account in accounts)
            {
                if (account.Id == contact.AccountId)
                {
                    contact.account = account;                      
                }
            }
        }
        contacts = data;
    }, handleError));
}, handleError));
</code></pre>

<p>Notice in the query that I&#8217;m fetching photoData__c, which is the custom field I created on Contact to store the photo.</p>

<p>In the renderer for a contact I need to either display the photo if there is one or let the user add one.  Here is the simple UI code to handle that:</p>

<pre><code>&lt;s:group width="92" top="8" right="8" height="92"&gt;
    &lt;s:rect width="92" height="92"&gt;
        &lt;s:fill&gt;
            &lt;s:solidcolor color="#cccccc"&gt;&lt;/s:solidcolor&gt;
        &lt;/s:fill&gt;
    &lt;/s:rect&gt;
    &lt;s:label verticalalign="middle" text="Add a photo" height="92" width="92" textalign="center" id="addPhoto"&gt;&lt;/s:label&gt;
    &lt;s:bitmapimage width="92" id="photo" height="92"&gt;&lt;/s:bitmapimage&gt;
&lt;/s:group&gt;
</code></pre>

<p>When the contact is set I check to see if there is a photo and if so display it:</p>

<pre><code>if (contact.photoData__c == null)
{
    photo.visible = false;
    return;
}

var decoder:Base64Decoder = new Base64Decoder();
decoder.decode(contact.photoData__c);

var loader:Loader = new Loader();
loader.contentLoaderInfo.addEventListener(Event.COMPLETE, function(event:Event):void {
    photo.source = event.target.content;
    photo.visible = true;
});
loader.loadBytes(decoder.toByteArray());
</code></pre>

<p>The data from the photoData__c field is Base64 decoded and then displayed using the Flex BitmapImage component.</p>

<p>Now when the user clicks on the photo or empty photo box I use the AIR for Android CameraUI to grab a photo, resize it, covert it to a PNG, Base64 encode it, set it on the contact, and then save the contact to Salesforce.com:</p>

<pre><code>if (CameraUI.isSupported)
{
    cameraUI = new CameraUI();
    cameraUI.addEventListener(MediaEvent.COMPLETE, function(event:MediaEvent):void {
        var loader:Loader = new Loader();
        loader.load(new URLRequest(event.data.file.url));
        loader.contentLoaderInfo.addEventListener(Event.COMPLETE, function(event:Event):void {
            var bitmap:Bitmap = event.target.content as Bitmap;

            var result:BitmapData = new BitmapData(46, 46, false);
            var matrix:Matrix = new Matrix();
            matrix.scale(46 / bitmap.width, 46 / bitmap.height);
            result.draw(bitmap, matrix);

            var pngEncoder:PNGEncoder = new PNGEncoder();
            var pngBytes:ByteArray = pngEncoder.encode(result);

            var base64Encoder:Base64Encoder = new Base64Encoder();
            base64Encoder.encodeBytes(pngBytes);
            var encodedImage:String = base64Encoder.flush();

            contact.photoData__c = encodedImage;

            displayPhoto();

            F3WebApplication.getInstance().wrapper.save(contact, new AsyncResponder(function(data:Object, token:Object=null):void {
            }, FlexGlobals.topLevelApplication.handleError));
        });
    });
    cameraUI.addEventListener(ErrorEvent.ERROR, function(event:ErrorEvent):void {
        FlexGlobals.topLevelApplication.handleError(event);
    });
    cameraUI.launch(MediaType.IMAGE);
}
</code></pre>

<p>That&#8217;s it for the mobile app!  I compiled it, exported it to an Android app, and then copied it to my phone.  Pretty simple and as you can see it works!  One limitation with my approach is the 32k limit of the photoData__c field.  However, I think I could easily get around that by striping the Base64 encoded data across multiple fields.  It&#8217;s not ideal but it would work.</p>

<p>To display the photo when I view a contact on Salesforce.com I created a very simple Flex app using another Force.com Flex Project.  I could have also added photo upload to this application but chose to keep it simple.  All it does is display the selected contact&#8217;s photo.  Here is the complete code (after generating the required services in Flash Builder):</p>

<pre><code>&lt;s:application xmlns:flexforforce="http://flexforforce.salesforce.com" xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark" xmlns:mx="library://ns.adobe.com/flex/mx"&gt;

    &lt;fx:script&gt;     
    import mx.rpc.AsyncResponder;
    import mx.utils.Base64Decoder;
    &lt;/fx:script&gt;

    &lt;fx:declarations&gt;
        &lt;flexforforce:f3webapplication id="app" requiredtypes="Contact"&gt;
            &lt;flexforforce:logincomplete&gt;
                app.wrapper.query("select photoData__c from Contact where Id = '" + this.parameters.contactId + "'", new AsyncResponder(function(data:Object, token:Object):void {
                    if (data.length == 1)
                    {
                        if (data[0].photoData__c == null)
                        {
                            photo.visible = false;
                            noPhoto.visible = true;
                            return;
                        }

                        var decoder:Base64Decoder = new Base64Decoder();
                        decoder.decode(data[0].photoData__c);

                        var loader:Loader = new Loader();
                        loader.contentLoaderInfo.addEventListener(Event.COMPLETE, function(event:Event):void {
                            photo.source = event.target.content;
                            photo.visible = true;
                        });
                        loader.loadBytes(decoder.toByteArray());
                    }
                }, function(fault:Object):void {
                    // ignored
                }));
            &lt;/flexforforce:logincomplete&gt;
        &lt;/flexforforce:f3webapplication&gt;
    &lt;/fx:declarations&gt;

    &lt;s:applicationcomplete&gt;
        app.serverUrl = this.parameters.serverUrl;
        app.loginBySessionId(this.parameters.sessionId);
    &lt;/s:applicationcomplete&gt;

    &lt;s:rect width="92" height="92"&gt;
        &lt;s:fill&gt;
            &lt;s:solidcolor color="#cccccc"&gt;&lt;/s:solidcolor&gt;
        &lt;/s:fill&gt;
    &lt;/s:rect&gt;

    &lt;s:label verticalalign="middle" visible="false" text="No Photo" height="92" width="92" textalign="center" id="noPhoto"&gt;&lt;/s:label&gt;

    &lt;s:bitmapimage width="92" id="photo" height="92"&gt;&lt;/s:bitmapimage&gt;

&lt;/s:application&gt;
</code></pre>

<p>Finally I created a custom S-Control to run the Flex app:</p>

<pre><code>&lt;object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="92" codebase="https://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab" id="ContactPhoto" height="92"&gt; 
    &lt;param name="movie" value="{!Scontrol.JavaArchive}"&gt;&lt;/param&gt; 
    &lt;param name="flashvars" value="sessionId={!API.Session_ID}&amp;serverUrl={!API.Partner_Server_URL_90}&amp;contactId={!Contact.Id}"&gt;&lt;/param&gt; 
    &lt;embed src="{!Scontrol.JavaArchive}" pluginspage="http://www.adobe.com/go/getflashplayer" name="ContactPhoto" height="92" width="92" type="application/x-shockwave-flash" flashvars="sessionId={!API.Session_ID}&amp;serverUrl={!API.Partner_Server_URL_90}&amp;contactId={!Contact.Id}"&gt; 
    &lt;/embed&gt; 
&lt;/object&gt;
</code></pre>

<p>I uploaded the compiled Flex app to the S-Control and added it to the Contact page.  And that&#8217;s it!  In just a few hours I extended Force.com and built a cool mobile app.  I could also have easily created a desktop widget for browsing contacts and adding photos.  If you are looking for a fun project to use as a way to learn this stuff that would be a good one!  :)</p>

<p>Here are some resources to help you get started with Flash Builder for Force.com:</p>

<ul>
<li><p><a href="http://wiki.developerforce.com/index.php/Force.com_Flex_Quick_Start_Tutorial">Force.com Flex Quick Start Tutorial</a></p></li>
<li><p><a href="http://developerforce.s3.amazonaws.com/website/afb/docs/ASDoc_Flex/index.html">Force.com Flex Project APIs for Web Applications</a></p></li>
<li><p><a href="http://developerforce.s3.amazonaws.com/website/afb/docs/ASDoc_AIR/index.html">Force.com Flex Project APIs for Desktop Applications</a></p></li>
<li><p><a href="http://developer.force.com/flashbuilder">Numerous other demo applications and tutorials</a></p></li>
<li><p><a href="http://github.com/jamesward/MobileContacts">Source code for my mobile contacts demo</a></p></li>
<li><p><a href="http://github.com/jamesward/WebContactSControl">Source code for my web contact photo viewer demo</a></p></li>
</ul>


<p>Have fun building the next generation of software!  Let me know how it goes.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/19/developing-mobile-flash-flex-scaling-and-zooming/">Developing Mobile Flash / Flex - Scaling and Zooming</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-19T11:29:10-06:00" pubdate data-updated="true">Jul 19<span>th</span>, 2010</time>
        
         | <a href="/2010/07/19/developing-mobile-flash-flex-scaling-and-zooming/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Mobile development with Flash and Flex is a new frontier, full of new adventures and discoveries.  Recently I discovered something that might be useful to you.  By default the mobile web browser on my Android 2.2 device scales a web page to make more room to display pages typically built for a desktop profile.  Here is what a little <a href="http://www.jamesward.com/demos/MobileSizeTest/MobileSizeTest.html">test mobile Flex app</a> I built looks like:
<img src="http://www.jamesward.com/wp/uploads/2010/07/mobile_flash-default.png" alt="" /></p>

<p>Strange!  The width and height are larger than the screen resolution.  You can fix this by adding the following to the HTML page:</p>

<pre><code>&lt;meta content="target-densityDpi=device-dpi; user-scalable=0;" name="viewport"&gt;&lt;/meta&gt;
</code></pre>

<p>And now it will look like:
<img src="http://www.jamesward.com/wp/uploads/2010/07/mobile_flash-noscale.png" alt="" /></p>

<p>Now that looks right!  This also turns off the two-finger / pinch zooming feature for the page (which is more important for content that hasn&#8217;t been optimized for a mobile profile).</p>

<p>I hope this is useful for those of you embarking on new adventures with Flash / Flex on mobile devices!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/07/amf-js-a-pure-javascript-amf-implementation/">amf.js - a Pure JavaScript AMF Implementation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-07T08:34:06-06:00" pubdate data-updated="true">Jul 7<span>th</span>, 2010</time>
        
         | <a href="/2010/07/07/amf-js-a-pure-javascript-amf-implementation/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just finished the first version of a new pure <a href="http://github.com/jamesward/JSAMF">JavaScript library for AMF</a>.  I&#8217;ve wanted to do this for a while but didn&#8217;t think it was possible since JavaScript doesn&#8217;t have a ByteArray.  But then I came across this: &#8221;<a href="http://www.adamia.com/blog/high-performance-javascript-port-of-actionscript-byteArray">High Performance JavaScript Port of ActionScript&#8217;s ByteArray</a>&#8221;.  That became the basis for <a href="http://github.com/jamesward/JSAMF">amf.js</a>.  Before I get into the gory details of how this works, check out some developer eye candy:
<a href="http://www.jamesward.com/demos/JSAMF/censusTest.html">http://www.jamesward.com/demos/JSAMF/censusTest.html</a></p>

<p>Ok, hopefully that worked for you.  I&#8217;ve tested this in the latest Chrome, Firefox, Safari, and IE and they all seem to work.  It should also work on your iPad, iPhone, or Android device.</p>

<p>Now for those gory details&#8230;  AMF is a protocol initially created in Flash Player as a way to serialize data for storage on disk or transfer over a network.  Typically in web apps we use text-based serialization protocols (like JSON or RESTful XML) for data transfer.  But there are some advantages to using binary protocols - primarily <a href="http://www.jamesward.com/2009/06/17/blazing-fast-data-transfer-in-flex/">much better performance</a>.  There are two versions of the AMF protocol, <a href="http://download.macromedia.com/pub/labs/amf/amf0_spec_121207.pdf">AMF0</a> and <a href="http://opensource.adobe.com/wiki/download/attachments/1114283/amf3_spec_05_05_08.pdf">AMF3</a>.  Both are publicly documented by Adobe and numerous server-side implementations of AMF exist.  AMF is just a serialization technology, not a transport.  So you can put AMF encoded data into any transport (like HTTP / HTTPS).  Typically Flash Player is the client that reads / writes AMF data.</p>

<p>I recently had a conversation with <a href="http://twitter.com/Stephan007">Stephan Janssen</a> who runs <a href="http://parleys.com">Parleys.com</a> (an amazing Flex app), which started me on this fun project. The Parleys.com PC-profile web client and the Adobe AIR desktop client both use BlazeDS and AMF as the primary serialization protocol for moving data between client and server.  This is a great choice for those clients because it makes the apps snappy.  But for the HTML5 client Stephan wants to reuse his AMF endpoints.  This is where amf.js comes in.</p>

<p>Flash Player has a ByteArray API that can be used for a lot of amazing things.  One of those things is to read and write AMF.  If you have an object in Flash Player and you create a new ByteArray and then call &#8220;byteArray.writeObject(myObject)&#8221; you will get a ByteArray with the AMF representation of that object.  Likewise if you get some AMF and you call &#8220;byteArray.readObject()&#8221; you get the object(s) from the AMF.  In Flex there are high level APIs (like RemoteObject, Consumer, etc.) that use this native AMF support in Flash Player.</p>

<p>To create a pure JavaScript AMF library the first thing that is needed is a pure JavaScript ByteArray library since JavaScript doesn&#8217;t natively have one.  I used one from <a href="http://www.adamia.com/blog/high-performance-javascript-port-of-actionscript-byteArray">adamia.com</a> since it was similar to the ByteArray in Flash Player, seemed fast, and seemed to parse floats correctly.  This ByteArray has some of the basic functions like readByte, readFloat, etc.  But what about that cool readObject function?  Well, that has to be built from scratch.  And it should support both AMF0 and AMF3.</p>

<p>Using the AMF specs and code from BlazeDS &amp; pyamf as a reference I was able to add the other functions to the ByteArray.  But there was a problem.  Using XMLHttpRequest as the method of getting the AMF was not working right.  Some bytes were incorrect.  It turns out XMLHttpRequest uses UTF-8 and that screws up some of the bytes above 128.  I tried other charsets and each one would change some range of bytes.  That is not good because I need the bytes to be exactly what the server sent.  Then I came across <a href="http://web.archive.org/web/20061114143134/http://mgran.blogspot.com/2006/08/downloading-binary-streams-with.html">this gem</a>:</p>

<pre><code>//XHR binary charset opt by Marcus Granado 2006 [http://mgran.blogspot.com]
req.overrideMimeType('text/plain; charset=x-user-defined');
</code></pre>

<p>Using the &#8220;x-user-defined&#8221; charset left the bytes alone.  Perfect!  Except that IE doesn&#8217;t support the req.overrideMimeType function.  But IE does actually have a real ByteArray available in req.responseBody via VBScript.  For now in IE I just change the ByteArray into a string (like req.responseText in the other browsers) although a lot of optimization could be done to just use the VBScript ByteArray directly.</p>

<p>Right now amf.js is just a basic JavaScript library for reading AMF data.  It doesn&#8217;t support using a BlazeDS MessageBrokerServlet yet because I need to be able to assemble a AMF object in JavaScript and send that in the HTTP request to the servlet.  But it works fine with a custom servlet that uses BlazeDS&#8217;s AMF library to just write AMF into the HTTP response.  It should also work with pyamf, AMFPHP, and other AMF server libraries.</p>

<p>To use amf.js start by dumping some AMF into an HTTP response.  In Java with BlazeDS I did this:</p>

<pre><code>public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException
{
    response.setHeader("Content-Type", "application/x-amf;charset=x-user-defined");
    ServletOutputStream out = response.getOutputStream();
    ActionMessage requestMessage = new ActionMessage(MessageIOConstants.AMF3);
    MessageBody amfMessage = new MessageBody();
    amfMessage.setData(someSerializableObject);
    requestMessage.addBody(amfMessage);
    AmfMessageSerializer amfMessageSerializer = new AmfMessageSerializer();
    amfMessageSerializer.initialize(SerializationContext.getSerializationContext(), out, new AmfTrace());
    amfMessageSerializer.writeMessage(requestMessage);
    out.close();
}
</code></pre>

<p>In a HTML web page add the amf.js script:</p>

<pre><code>&lt;script src="amf.js" type="text/javascript"&gt;&lt;/script&gt;
</code></pre>

<p>In JavaScript make a XHR request for some data:</p>

<pre><code>var url = "TestServlet";
var req;

function getAMF()
{
    if (window.ActiveXObject)
    {
        req = new ActiveXObject("Microsoft.XMLHTTP");
    }
    else if (window.XMLHttpRequest)
    {
        req = new XMLHttpRequest();
        //XHR binary charset opt by Marcus Granado 2006 [http://mgran.blogspot.com]
        req.overrideMimeType('text/plain; charset=x-user-defined');
    }
    req.onreadystatechange = processReqChange;
    req.open("GET", url, true);
    req.send(null);
}
</code></pre>

<p>And when the response comes back decode the AMF:</p>

<pre><code>function processReqChange()
{
    if (req.readyState == 4)
    {
        if (req.status == 200)
        {
            var o = decodeAMF(req.responseText).messages[0].body;
        }
        else
        {
            alert("There was a problem retrieving the data:\n" + req.statusText);
        }
    }
}
</code></pre>

<p>For details on how to support IE, check out the source code for <a href="http://www.jamesward.com/demos/JSAMF/censusTest.html">censusTest.html</a>.</p>

<p>While amf.js works in my tests there is more work to be done.  I need to add the write functions so that AMF can be sent to the server.  Then supporting BlazeDS&#8217;s MessageBrokerServlet should be pretty straightforward.  I&#8217;d also like to create pure JavaScript implementations of Flex&#8217;s RemoteObject, Consumer, and Producer APIs.  Also, I need people to test amf.js with their AMF to make sure that I&#8217;ve implemented things correctly.  All of the <a href="http://github.com/jamesward/JSAMF">code is on github.com</a> so go ahead and fork it!  Let me know what you think.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/06/21/tour-de-flex-2-0-nearly-500-flex-examples/">Tour De Flex 2.0 - Nearly 500 Flex Examples!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-21T08:45:42-06:00" pubdate data-updated="true">Jun 21<span>st</span>, 2010</time>
        
         | <a href="/2010/06/21/tour-de-flex-2-0-nearly-500-flex-examples/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Adobe has just launched the new AIR 2 based <a href="http://flex.org/tour">Tour de Flex version 2.0</a> which now contains almost 500 Flex examples!  The new version has new AIR 2 examples (only available in the AIR version of Tour de Flex) including:</p>

<ul>
<li><p>File Promises</p></li>
<li><p>Mass Storage Detection</p></li>
<li><p>Native Process</p></li>
<li><p>Open with default app</p></li>
<li><p>Socket Server</p></li>
</ul>


<p>Also there are some great examples of the new Flash Player 10.1 and AIR 2 APIs including:</p>

<ul>
<li><p>Gestures</p></li>
<li><p>Global Error Handler</p></li>
<li><p>Globalization / Internationalization</p></li>
<li><p>Microphone access</p></li>
</ul>


<p>Those are some great examples but my favorite is still <a href="http://dougmccune.com/blog/">Doug McCune&#8217;s</a> <a href="http://www.adobe.com/devnet/flex/tourdeflex/web/#docIndex=0;illustIndex=0;sampleId=16300">Physics Form</a> followed closely by the <a href="http://www.adobe.com/devnet/flex/tourdeflex/web/#docIndex=-1;illustIndex=0;sampleId=14050">real-time Tour de Flex Dashboard</a>.  :)</p>

<p>If you already have Tour de Flex installed then it should auto update to the latest version when you launch it.  Otherwise install it now using the badge installer below.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/06/18/top-10-stackoverflow-com-flex-contributors/">Top 10 StackOverflow.com Flex Contributors</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-18T09:43:34-06:00" pubdate data-updated="true">Jun 18<span>th</span>, 2010</time>
        
         | <a href="/2010/06/18/top-10-stackoverflow-com-flex-contributors/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Back in the day the <a href="http://tech.groups.yahoo.com/group/flexcoders/">FlexCoders Yahoo! Group</a> was all the rage.  It was the place where Flex rock stars like <a href="http://blogs.adobe.com/aharui/">Alex Harui</a> and <a href="http://dougmccune.com/blog/">Doug McCune</a> hung out and helped the community learn Flex.  But these days a lot of developers have turned to <a href="http://www.stackoverflow.com">StackOverflow.com</a> as their primary resource for getting answers to their technical questions.  I started using Stack Overflow over a year ago primarily because it makes it easy to follow the conversation around a specific question and quickly identify the right answer.  Stack Overflow totally nails what I need as a developer when I have problems and questions.  Many Flex rock stars have stepped up and frequently answered questions on Stack Overflow and I wanted to highlight the top 10 contributors to <a href="http://stackoverflow.com/questions/tagged?tagnames=flex&amp;sort=newest&amp;pagesize=50">the &#8220;Flex&#8221; tag</a>.</p>

<p>As of June 18, 2010 the top 10 Flex contributors on Stack Overflow (<a href="http://stackoverflow.com/questions/tagged?tagnames=flex&amp;sort=stats&amp;pagesize=50">based on &#8220;All Time&#8221; total score</a>) are:</p>

<p><strong>#1</strong></p>

<p>Blog: <a href="http://amarghosh.blogspot.com/">http://amarghosh.blogspot.com/</a>
Twitter: <a href="http://twitter.com/amrghosh">@amrghosh</a></p>

<p><strong>#2</strong></p>

<p>Blog: <a href="http://histos.net/">http://histos.net/</a>
Twitter: <a href="http://twitter.com/cliffmeyers">@cliffmeyers</a></p>

<p><strong>#3</strong></p>

<p>Blog: <a href="http://blog.iconara.net/">http://blog.iconara.net/</a></p>

<p><strong>#4</strong></p>

<p>Whoot!  That&#8217;s me!
Blog: <a href="http://www.jamesward.com/">http://www.jamesward.com/</a>
Twitter: <a href="http://twitter.com/riacowboy">@riacowboy</a></p>

<p><strong>#5</strong></p>

<p>Blog: <a href="http://turbonerd.com/">http://turbonerd.com/</a></p>

<p><strong>#6</strong></p>

<p>Blog: <a href="http://joshblog.net/">http://joshblog.net/</a>
Twitter: <a href="http://twitter.com/joshtynjala">@joshtynjala</a></p>

<p><strong>#7</strong></p>

<p>Blog: <a href="http://www.herrodius.com/">http://www.herrodius.com/</a>
Twitter: <a href="http://twitter.com/herrodius">@herrodius</a></p>

<p><strong>#8</strong></p>

<p>Blog: <a href="http://blog.richardszalay.com/">http://blog.richardszalay.com/</a></p>

<p><strong>#9</strong></p>

<p><strong>#10</strong></p>

<p>Thanks to everyone who contributes to the Flex community on Stack Overflow!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/06/14/flex-4-hibernate-3-and-spring-3-integration/">Flex 4, Hibernate 3, and Spring 3 Integration</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-14T12:58:18-06:00" pubdate data-updated="true">Jun 14<span>th</span>, 2010</time>
        
         | <a href="/2010/06/14/flex-4-hibernate-3-and-spring-3-integration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://ectropic.com">Jon Rose</a> and I have created a new <a href="http://refcardz.dzone.com/">DZone Refcard</a> called <a href="http://refcardz.dzone.com/refcardz/flex-4-and-spring-3">Flex 4 and Spring 3 Integration</a>.  In the Refcard, we walk you through the steps for building RIAs with Flash Builder 4, Flex 4, BlazeDS 4, Spring 3, the Spring BlazeDS Integration, and Hibernate.  Whew!  That&#8217;s a lot of pieces!  The Refcard covers simple Remoting, Flex &amp; Hibernate integration through Spring (all Java annotation driven and using the new data-centric development features in Flash Builder 4), Pub / Sub Messaging, and Flex and Spring Security.  We pack a lot into six pages!</p>

<p>If you want to see recorded presentations / screencasts of some of these things check out:</p>

<ul>
<li><p><a href="http://seminars.adobe.acrobat.com/p31679079/">What&#8217;s new in Flash Builder 4 for Java Developers</a></p></li>
<li><p><a href="http://www.jamesward.com/2010/01/11/flash-builder-4-data-wizards-with-java-spring/">Flash Builder 4 Data Wizards with Java / Spring</a></p></li>
<li><p><a href="http://www.jamesward.com/2010/01/17/flex-4-and-java-spring-hibernate-in-flash-builder-4/">Flex 4, Java, Spring, and Hibernate in Flash Builder 4</a></p></li>
</ul>


<p>I hope all of this is helpful.  Let me know what you think.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/06/09/improved-open-source-testing-tools-for-flex/">Improved Open Source Testing Tools for Flex</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-09T08:44:39-06:00" pubdate data-updated="true">Jun 9<span>th</span>, 2010</time>
        
         | <a href="/2010/06/09/improved-open-source-testing-tools-for-flex/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Back in the early days of Flex there wasn&#8217;t much for doing unit testing, automated testing, performance testing, etc.  Thanks to the community there are now numerous open source testing tools for Flex.  Here are some recent updates you should definitely check out if you are building production Flex apps:</p>

<ul>
<li><p><a href="http://www.flexunit.org/?p=62">FlexUnit 4.1 Beta 1</a></p></li>
<li><p><a href="http://flexmonkey.org/wordpress/2010/05/11/flex-4-support-now-available-from-flexmonkey-gorilla-logic/">FlexMonkey (open source automated testing) now supports Flex 4</a></p></li>
<li><p><a href="http://pushbuttonengine.com/2010/06/pushbutton-labs-profiler-open-sourced/">PushButton Labs Profiler for Flex</a></p></li>
</ul>


<p>It&#8217;s very exciting to see these community driven projects continue to improve testing for Flex apps.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/05/26/flash-platform-and-salesforce-com-webinar-and-mobile-app/">Flash Platform and Salesforce.com Webinar and Mobile App</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-26T09:59:31-06:00" pubdate data-updated="true">May 26<span>th</span>, 2010</time>
        
         | <a href="/2010/05/26/flash-platform-and-salesforce-com-webinar-and-mobile-app/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Client + Cloud technologies have been quickly evolving and maturing.  The combination of Flex and Salesforce.com continue to lead the way for next generation Client + Cloud applications.  Recently I did a <a href="http://seminars.adobe.acrobat.com/p26603860/">Webinar on The Flash Platform and Salesforce.com</a> with Dave Carroll from Salesforce.  If you missed it you can watch the recording to see how you can begin developing Client + Cloud apps.  Also <a href="http://blog.jeffdouglas.com/2010/02/01/adobe-air-applications-with-salesforce/">watch Jeff Douglas demo an offline case management app</a> he built with Flex and Force.com.  Awesome stuff!</p>

<p>Last week I was able to spend a few hours with <a href="http://www.modelmetrics.com">Model Metrics</a> porting their <a href="http://www.modelmetrics.com/solutions/2go-mobile-cloud-platform/">Pharma2GO Adobe AIR app</a> to run on an Android Mobile device.  Using the <a href="http://labs.adobe.com/technologies/air2/android/">AIR for Android Prerelease</a> we quickly created a mobile friendly UI with Flex and reused the same data sync code from the desktop app.  Check out the end result:</p>

<p>Listen to what Model Metrics had to say about this in their blog &#8221;<a href="http://www.modelmetrics.com/general/html-5-%E2%80%93-ready-for-primetime-in-the-enterprise/">HTML 5 â€“ Ready for Primetime in the Enterprise?</a>&#8221;:</p>

<blockquote><p>One of our early iPhone products on the iTunes AppStore was Search2GO, a simple search tool for Salesforce.com.  This was built in Objective C and it took approximately 8 weeks to develop.  Yesterday I watched two developers create over half of this same functionality using Flex/AIR and had it running on an Android phone in a day.  Granted there are still things that could be added, but this was a great illustration of why Flex/AIR is a great toolset.</p></blockquote>

<p>These are exciting times for Client + Cloud apps now that the &#8220;Client&#8221; can easily be on the web, desktop, and mobile device using the same technologies and tools!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/05/21/flex-on-android-in-flash-player-and-air/">Flex on Android in Flash Player and AIR</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-21T09:07:18-06:00" pubdate data-updated="true">May 21<span>st</span>, 2010</time>
        
         | <a href="/2010/05/21/flex-on-android-in-flash-player-and-air/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This week at the Google I/O conference Adobe announced that a Flash Player 10.1 beta and an Adobe AIR prerelease are now available for Android devices.  This is really exciting news for those of us building apps on the Flash Platform because now we can begin building apps in Flex for these mobile devices (and many others coming soon).</p>

<p>Take a look a some of the quick demos I&#8217;ve built with Flex running on Android in Flash Player and AIR:</p>

<p>You can get the source code for all of these demos from <a href="http://github.com/jamesward">github</a>.</p>

<p>Also <a href="http://coenraets.org">Christophe Coenraets</a> has posted some great Flex mobile demos.  Check out his <a href="http://coenraets.org/blog/2010/05/sample-application-using-flex-and-air-for-android/">Employee Directory</a> and <a href="http://coenraets.org/blog/2010/05/android-trader-application-with-flex-4-and-air/">Stock Trader</a> demos.</p>

<p>These are very exciting times for developers!</p>

<p>If you want to check out the Flash Player 10.1 beta for Android it will be available in the Android Marketplace for Android 2.2 devices.  You can try Adobe AIR for Android today by <a href="http://blogs.adobe.com/air/2010/05/air_android_prerelease.html">signing up for the prerelease</a>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/8/">&larr; Older</a>
    
    <a href="/archives">Blog Archives</a>
    
    <a class="next" href="/page/6/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("_JamesWard", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/_JamesWard" class="twitter-follow-button" data-show-count="false">Follow @_JamesWard</a>
  
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101156657838073927919?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/jamesward">@jamesward</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jamesward',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/12/12/heroku-jug-tour-boulder-phoenix-portland/">Heroku JUG Tour: Boulder, Phoenix, & Portland</a>
      </li>
    
      <li class="post">
        <a href="/2011/12/11/tutorial-play-framework-jpa-json-jquery-heroku/">Tutorial: Play Framework, JPA, JSON, jQuery, & Heroku</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/30/using-mongodb-for-a-java-web-apps-httpsession/">Using MongoDB for a Java Web App&#8217;s HttpSession</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/30/heroku-java-user-group-tour-columbus-and-orange-county/">Heroku Java User Group Tour: Columbus and Orange County</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/29/heroku-preso-from-devoxx-2011/">Heroku Preso from Devoxx 2011</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - James Ward -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jamesward';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
